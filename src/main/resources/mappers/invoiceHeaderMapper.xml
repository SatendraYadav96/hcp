<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="InvoiceHeaderMapper">
    <resultMap id="invoiceHeaderResultMap" type="com.squer.promobee.service.repository.domain.InvoiceHeader">
        <id property="id" column="id_inh"/>
        <result property="invoiceNo" column="invoice_no_inh"/>
        <result property="addressLine1" column="address_line_1_inh"/>
        <result property="addressLine2" column="address_line_2_inh"/>
        <result property="states" column="address_state_inh"/>
        <result property="city" column="address_city_inh"/>
        <result property="zip" column="address_zip_inh"/>
        <result property="phone" column="phone_inh"/>
        <result property="weight" column="weight_inh"/>
        <result property="noOfBoxes" column="no_of_boxes_inh"/>
        <result property="notes" column="notes_inh"/>
        <result property="sampleValue" column="sample_value_inh"/>
        <result property="otherItemValue" column="other_item_value_inh"/>
        <result property="indirectedId" column="indirectedinh_inh"/>
        <result property="groupInvoiceNo" column="group_invoice_no_inh"/>
        <result property="groupInvoiceId" column="id_group_invoice_inh"/>
        <result property="lrNumber" column="lr_number_inh"/>
        <result property="cfa" column="cfa_inh"/>
        <result property="createdAt" column="created_on_inh"/>
        <result property="createdBy" column="created_by_inh"/>
        <result property="updatedAt" column="updated_on_inh"/>
        <result property="updatedBy" column="updated_by_inh"/>
        <result property="type.id" column="id_type_slv_inh"/>
        <result property="type.name" column="name_slv"/>
        <result property="statusId.id" column="id_status_slv_inh"/>
        <result property="statusId.name" column="name_inh"/>
        <result property="teamId.id" column="id_tem_inh"/>
        <result property="teamId.name" column="name_tem"/>
        <result property="recipientId.id" column="id_rct_inh"/>
        <result property="recipientId.name" column="name_rct"/>
        <result property="transporterId.id" column="id_trn_inh"/>
        <result property="transporterId.name" column="name_trn"/>
        <result property="designationId.id" column="id_rct_desg_ulv_inh"/>
        <result property="designationId.name" column="name_ulv"/>
<!--        <association property="type" javaType="com.squer.promobee.service.repository.domain.UserStatus">-->
<!--            <id property="id" column="id_type_slv_inh"/>-->
<!--            <result property="name" column="name_slv"/>-->
<!--        </association>-->
<!--        <association property="statusId" javaType="com.squer.promobee.service.repository.domain.UserStatus">-->
<!--            <id property="id" column="id_status_slv_inh"/>-->
<!--            <result property="name" column="name_inh"/>-->
<!--        </association>-->
<!--        <association property="teamId" javaType="com.squer.promobee.service.repository.domain.Team">-->
<!--            <id property="id" column="id_tem_inh"/>-->
<!--            <result property="name" column="name_tem"/>-->
<!--        </association>-->
<!--        <association property="recipientId" javaType="com.squer.promobee.service.repository.domain.Recipient">-->
<!--            <id property="id" column="id_rct_inh"/>-->
<!--            <result property="name" column="name_rct"/>-->
<!--        </association>-->
<!--        <association property="transporterId" javaType="com.squer.promobee.security.domain.NamedSquerEntity">-->
<!--            <id property="id" column="id_trn_inh"/>-->
<!--            <result property="name" column="name_trn"/>-->
<!--        </association>-->
<!--        <association property="designationId" javaType="com.squer.promobee.service.repository.domain.UserDesignation">-->
<!--            <id property="id" column="id_rct_desg_ulv_inh"/>-->
<!--            <result property="name" column="name_ulv"/>-->
<!--        </association>-->
    </resultMap>


    <update id="editInvoiceHeader">
        UPDATE INVOICE_HEADER_INH SET WEIGHT_INH = #{weight} , NO_OF_BOXES_INH = #{noOfBoxes} , UPDATED_BY_INH = #{updatedBy} , UPDATED_ON_INH = GETDATE()
        WHERE INVOICE_NO_INH = #{invoiceNo}
    </update>


    <insert id="insertReversalInvoiceHeader" >
        insert into INVOICE_HEADER_INH
        (ID_INH,INVOICE_NO_INH,ID_TYPE_SLV_INH,ID_STATUS_SLV_INH,ID_TEM_INH,ID_RCT_INH,ADDRESS_LINE_1_INH,ADDRESS_STATE_INH,ADDRESS_CITY_INH,ADDRESS_ZIP_INH,NOTES_INH,
         ID_TRN_INH,CREATED_ON_INH,CREATED_BY_INH,UPDATED_ON_INH,UPDATED_BY_INH,ID_RCT_DESG_ULV_INH)
        values (
                   NEWID(),(SELECT MAX(INVOICE_NO_INH) FROM INVOICE_HEADER_INH) + 1,#{type},#{statusId},#{teamId},#{recipientId},
                   '','','','',#{notes},#{transporterId},GETDATE(),#{createdBy},GETDATE(),#{updatedBy},#{designationId})
    </insert>

<!--    <insert id="insertReversalInvoiceHeader" >-->
<!--        insert into INVOICE_HEADER_INH-->
<!--        (ID_INH,INVOICE_NO_INH,ID_TYPE_SLV_INH,ID_STATUS_SLV_INH,ID_TEM_INH,ID_RCT_INH,ADDRESS_LINE_1_INH,ADDRESS_STATE_INH,ADDRESS_CITY_INH,ADDRESS_ZIP_INH,NOTES_INH,-->
<!--         ID_TRN_INH,CREATED_ON_INH,CREATED_BY_INH,UPDATED_ON_INH,UPDATED_BY_INH,ID_RCT_DESG_ULV_INH)-->
<!--        values (-->
<!--                   NEWID(),#{invoiceNo},#{type},#{statusId},#{teamId},#{recipientId},-->
<!--                   '','','','',#{notes},#{transporterId},GETDATE(),#{createdBy},GETDATE(),#{updatedBy},#{designationId})-->
<!--    </insert>-->

    <select id="getMaxInvoiceNo" resultMap="invoiceHeaderResultMap">
        SELECT MAX(INVOICE_NO_INH) FROM INVOICE_HEADER_INH
    </select>

    <insert id="insertSwitchInvoiceHeader" >
        insert into INVOICE_HEADER_INH
        (ID_INH,INVOICE_NO_INH,ID_TYPE_SLV_INH,ID_STATUS_SLV_INH,ID_TEM_INH,ID_RCT_INH,ADDRESS_LINE_1_INH,ADDRESS_STATE_INH,ADDRESS_CITY_INH,ADDRESS_ZIP_INH,NOTES_INH,
         ID_TRN_INH,CREATED_ON_INH,CREATED_BY_INH,UPDATED_ON_INH,UPDATED_BY_INH)
        values (
                   NEWID(),(SELECT MAX(INVOICE_NO_INH) FROM INVOICE_HEADER_INH) + 1,#{type},#{statusId},#{teamId},#{recipientId},
                   '','','','',#{notes},#{transporterId},GETDATE(),#{createdBy},GETDATE(),#{updatedBy})
    </insert>

    <insert id="insertSwitchInvoiceHeader1" >
        insert into INVOICE_HEADER_INH
        (ID_INH,INVOICE_NO_INH,ID_TYPE_SLV_INH,ID_STATUS_SLV_INH,ID_TEM_INH,ID_RCT_INH,ADDRESS_LINE_1_INH,ADDRESS_STATE_INH,ADDRESS_CITY_INH,ADDRESS_ZIP_INH,NOTES_INH,
         ID_TRN_INH,CREATED_ON_INH,CREATED_BY_INH,UPDATED_ON_INH,UPDATED_BY_INH)
        values (
                   NEWID(),(SELECT MAX(INVOICE_NO_INH) FROM INVOICE_HEADER_INH) + 1,#{type},#{statusId},#{teamId},#{recipientId},
                   '','','','',#{notes},#{transporterId},GETDATE(),#{createdBy},GETDATE(),#{updatedBy})
    </insert>


    <select id="getInvoiceHeaderById" resultMap="invoiceHeaderResultMap">
        SELECT INH.*,SLV.NAME_SLV,TEM.NAME_TEM,TRN.NAME_TRN,ULV.NAME_ULV,RCT.NAME_RCT FROM INVOICE_HEADER_INH INH
        JOIN TEAM_MASTER_TEM TEM ON TEM.ID_TEM = INH.ID_TEM_INH
        JOIN SYSTEM_LOV_SLV SLV ON SLV.ID_SLV = INH.ID_STATUS_SLV_INH
        JOIN TRANSPORTER_TRN TRN ON TRN.ID_TRN = INH.ID_TRN_INH
        JOIN USER_LOV_ULV ULV ON ULV.ID_ULV = INH.ID_RCT_DESG_ULV_INH
        JOIN RECIPIENT_MASTER_RCT RCT ON RCT.ID_RCT = INH.ID_RCT_INH
        WHERE ID_INH = #{id}
    </select>



    <select id="getVirtualPrintInvoiceHeaders" resultMap="invoiceHeaderResultMap">
        SELECT  inh.ID_INH as invoiceHeaderId,
                inh.INVOICE_NO_INH as invoiceNumber,
                ulv.NAME_ULV as employeeDesignation,
                DTM.ID_DTM as employeeId,
                DTM.NAME_DTM as employeeName,
                DTM.CODE_DTM as employeeCode,
                inh.ADDRESS_LINE_1_INH as employeeAddress,
                inh.ADDRESS_CITY_INH as employeeCity,
                inh.ADDRESS_STATE_INH as employeeState,
                inh.ADDRESS_ZIP_INH as employeePinCode,
                inh.PHONE_INH as employeeMobileNumber,
                inh.LR_NUMBER_INH as employeeLRNumber,
                GETDATE() as employeeDate,
                inh.CREATED_ON_INH as employeeLRDate,
                tem.NAME_TEM as employeeTeam,
                trn.NAME_TRN as employeeTransport,
                '' as employeePermitNo,
                inh.CFA_INH as employeeCFA,
                inh.NO_OF_BOXES_INH as employeeTotalNoOfCases,
                inh.WEIGHT_INH as employeeTotalWeight,
                dip.ID_DIP as dipId,
                dip.REMARKS_DIP as employeeRemark,
                dip.MONTH_DIP as month,
 dip.YEAR_DIP as year,
 dip.IS_SPECIAL_DIP as isSpecial,
 dip.QTR_DIP as qtr,
         inh.ID_TEM_INH as teamId
        FROM INVOICE_HEADER_INH INH
        JOIN DOCTOR_MASTER_DTM DTM ON DTM.ID_DTM = INH.ID_RCT_INH
        JOIN TEAM_MASTER_TEM TEM ON TEM.ID_TEM = INH.ID_TEM_INH
        JOIN USER_LOV_ULV ULV ON ULV.ID_ULV = INH.ID_RCT_DESG_ULV_INH
        JOIN INVOICE_DISPATCH_PLAN_IDP IDP ON IDP.ID_INH_IDP = INH.ID_INH
        JOIN DISPATCH_PLAN_DIP DIP ON DIP.ID_DIP = IDP.ID_PLAN_IDP
        JOIN TRANSPORTER_TRN TRN ON TRN.ID_TRN = INH.ID_TRN_INH
        WHERE ID_INH = #{id}

    </select>


    <select id="getPrintInvoiceHeaders" resultMap="invoiceHeaderResultMap">
        SELECT  inh.ID_INH as invoiceHeaderId,
                inh.INVOICE_NO_INH as invoiceNumber,
                ulv.NAME_ULV as employeeDesignation,
                rct.ID_RCT as employeeId,
                rct.NAME_RCT as employeeName,
                rct.CODE_RCT as employeeCode,
                inh.ADDRESS_LINE_1_INH as employeeAddress,
                inh.ADDRESS_CITY_INH as employeeCity,
                inh.ADDRESS_STATE_INH as employeeState,
                inh.ADDRESS_ZIP_INH as employeePinCode,
                inh.PHONE_INH as employeeMobileNumber,
                inh.LR_NUMBER_INH as employeeLRNumber,
                GETDATE() as employeeDate,
                inh.CREATED_ON_INH as employeeLRDate,
                tem.NAME_TEM as employeeTeam,
                trn.NAME_TRN as employeeTransport,
                '' as employeePermitNo,
                inh.CFA_INH as employeeCFA,
                inh.NO_OF_BOXES_INH as employeeTotalNoOfCases,
                inh.WEIGHT_INH as employeeTotalWeight,
                dip.ID_DIP as dipId,
                dip.REMARKS_DIP as employeeRemark,
                dip.MONTH_DIP as month,
 dip.YEAR_DIP as year,
 dip.IS_SPECIAL_DIP as isSpecial,
 dip.QTR_DIP as qtr,
         inh.ID_TEM_INH as teamId
        FROM INVOICE_HEADER_INH INH
        JOIN RECIPIENT_MASTER_RCT RCT ON RCT.ID_RCT = INH.ID_RCT_INH
        JOIN TEAM_MASTER_TEM TEM ON TEM.ID_TEM = INH.ID_TEM_INH
        JOIN USER_LOV_ULV ULV ON ULV.ID_ULV = INH.ID_RCT_DESG_ULV_INH
        JOIN INVOICE_DISPATCH_PLAN_IDP IDP ON IDP.ID_INH_IDP = INH.ID_INH
        JOIN DISPATCH_PLAN_DIP DIP ON DIP.ID_DIP = IDP.ID_PLAN_IDP
        JOIN TRANSPORTER_TRN TRN ON TRN.ID_TRN = INH.ID_TRN_INH
        WHERE ID_INH = #{id}

    </select>





</mapper>
