<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ReportMapper">




    <select id="getReportRecipient" resultType="com.squer.promobee.controller.dto.RecipientReportDTO">


SELECT BUM.NAME_BUM as 'businessUnit',RCT.CODE_RCT as 'employeeCode',RCT.NAME_RCT AS 'employeeName',RCT.ADDRESS_RCT AS 'address',
        RCT.CITY_RCT AS 'city',ULV.NAME_ULV AS 'designation',RCT.STATE_RCT AS 'state',RCT.ZIP_RCT AS 'zip',RCT.ZONE_RCT AS 'zone',RCT.LoginId AS 'loginId',
        RCT.WorkId AS 'workId',RCT.Gender AS 'gender',RCT.JOINING_DATE_RCT AS 'joiningDate',RCT.MOBILE_RCT AS 'mobile',RCT.EMAIL_RCT AS 'email',
        TEM.NAME_TEM AS 'team',RCT.NSM_NAME_RCT AS 'nsmName',RCT.NSM_CODE_RCT AS 'nsmCode',RCT.RM_NAME_RCT AS 'rmName',RCT.RM_CODE_RCT AS 'rmCode',
        rct.EMAIL_RM AS 'emailRM',rct.EMAIL_AM AS 'emailAM',BUM.NAME_BUM AS 'businessUnit',
        RCT.AM_NAME_RCT AS 'amName',RCT.AM_CODE_RCT AS 'amCode',RCT.CFA_RCT AS 'cfa',RCT.HEAD_QUARTER_RCT AS 'hq',SLV.NAME_SLV AS 'status' FROM RECIPIENT_MASTER_RCT RCT
        JOIN TEAM_MASTER_TEM TEM ON TEM.ID_TEM =  RCT.ID_TEM_RCT
        JOIN USER_LOV_ULV ULV ON ULV.ID_ULV =  RCT.ID_DESG_ULV_RCT
        join DIVISION_MASTER_DIM dim on dim.ID_DIM = tem.ID_DIM_TEM
        JOIN BU_MASTER_BUM BUM ON BUM.ID_BUM = dim.ID_BUM_DIM
        join SYSTEM_LOV_SLV slv on slv.ID_SLV = RCT.ID_STATUS_SLV_RCT
        Where RCT.ID_STATUS_SLV_RCT = #{statusId} and
              TEM.ID_TEM in <foreach item="item" index="index" collection="team"
                                     open="(" separator="," close=")">
        #{item}
    </foreach>
          and BUM.ID_BUM in <foreach item="item" index="index" collection="businessUnit"
                                     open="(" separator="," close=")">
        #{item}
    </foreach>
    </select>



    <select id="getReportPurchase" resultType="com.squer.promobee.controller.dto.PurchaseReportDTO">

        SELECT * INTO #FilterTable FROM
        (
        select BRD.ID_BRD,BUM.NAME_BUM as 'businessUnit', DIM.NAME_DIM as 'divison' from
        BRAND_MASTER_BRD BRD
        join DIVISION_BRAND_DBR DBR on BRD.ID_BRD= dbr.ID_BRD_DBR
        join DIVISION_MASTER_DIM DIM on dbr.ID_DIM_DBR =Dim.ID_DIM
        join BU_MASTER_BUM BUM on DIM.ID_BUM_DIM = BUM.ID_BUM
        where DIM.ID_BUM_DIM  in (<foreach item="item" index="index" collection="BusinessUnit"
                                           separator=",">
        #{item}
    </foreach>)
        and  DIM.ID_DIM  in (<foreach item="item" index="index" collection="Division"
                                      separator=",">
        #{item}
    </foreach>)

        ) AS FilterResult

        SELECT * INTO #Purchase1 FROM (
        SELECT  distinct FT.businessUnit,FT.divison,BBR.ID_USR_BBR AS 'BrandManagerID',usr.NAME_USR as 'BrandManager',INV.ID_INV,CCM.ID_CCM 'CostCenterID',CONVERT(nvarchar(100), INV.POSTING_DATE_INV, 103) AS grnDate, VND.NAME_VND AS vendorName, VND.CODE_VND AS vendorCode, INV.PO_NO_INV AS poNo,
        ITM.NAME_ITM AS productName, ITM.CODE_ITM AS productCode, CCM.NAME_CCM AS 'costCenter', INV.QTY_RECEIVED_INV AS quantity,
        --INV.RATE_PER_UNIT_INV AS rate,(INV.RATE_PER_UNIT_INV * INV.QTY_RECEIVED_INV) AS value,
        Round(INV.RATE_PER_UNIT_INV,2) AS rate,Round(INV.RATE_PER_UNIT_INV * INV.QTY_RECEIVED_INV,0) AS value,
        inv.BATCH_NO_INV as 'batchNo',inv.MEDICAL_CODE_INV as 'medicalCode',inv.NUM_BOXES_INV as 'noBoxes'
        FROM INVENTORY_INV INV
        JOIN ITEM_MASTER_ITM ITM ON INV.ID_ITM_INV = ITM.ID_ITM
        JOIN VENDOR_MASTER_VND VND ON INV.ID_VND_INV = VND.ID_VND
        JOIN COST_CENTER_MASTER_CCM CCM ON ITM.ID_CCM_ITM = CCM.ID_CCM
        join COSTCENTER_BRAND_CBR CBR on CCM.ID_CCM=CBR.ID_CCM_CBR
        JOIN BRAND_MASTER_BRD BRD ON CBR.ID_BRD_CBR = BRD.ID_BRD
        JOIN BRANDMANAGER_BRAND_BBR BBR ON CBR.ID_BRD_CBR = BBR.ID_BRD_BBR
        join USER_MASTER_USR usr on usr.ID_USR = BBR.ID_USR_BBR
        JOIN #FilterTable FT on BRD.ID_BRD  = FT.ID_BRD
        WHERE INV.POSTING_DATE_INV &gt;= #{startDate} AND INV.POSTING_DATE_INV &lt;=  #{endDate}
        UNION
        SELECT distinct FT.businessUnit,FT.divison,BBR1.ID_USR_BBR AS 'BrandManagerID',usr.NAME_USR as 'BrandManager',INV.ID_INV,BRD1.ID_BRD 'CostCenterID',CONVERT(nvarchar(100), INV.POSTING_DATE_INV, 103) AS grnDate,
        ISNULL(VND.NAME_VND,'TEST') AS vendorName,ISNULL(VND.CODE_VND, 'TEST') AS vendorCode, INV.PO_NO_INV AS poNo,
        SMP.NAME_SMP AS productName, SMP.LMID_SMP AS productCode, BRD1.NAME_BRD AS 'costCenter', INV.QTY_RECEIVED_INV AS quantity,
        --INV.RATE_PER_UNIT_INV AS rate, 	(INV.RATE_PER_UNIT_INV * INV.QTY_RECEIVED_INV) AS value,
        Round(INV.RATE_PER_UNIT_INV,2) AS rate,Round(INV.RATE_PER_UNIT_INV * INV.QTY_RECEIVED_INV,0) AS value,
        inv.BATCH_NO_INV as 'batchNo',inv.MEDICAL_CODE_INV as 'medicalCode',inv.NUM_BOXES_INV as 'noBoxes'
        FROM INVENTORY_INV INV
        JOIN SAMPLE_MASTER_SMP SMP ON INV.ID_ITM_INV = SMP.ID_SMP
        left JOIN VENDOR_MASTER_VND VND ON INV.ID_VND_INV = VND.ID_VND
        JOIN BRANDMANAGER_BRAND_BBR BBR1 ON SMP.ID_BRD_SMP = BBR1.ID_BRD_BBR
        JOIN BRAND_MASTER_BRD BRD1 ON BBR1.ID_BRD_BBR = BRD1.ID_BRD
        join USER_MASTER_USR usr on usr.ID_USR = BBR1.ID_USR_BBR
        JOIN  #FilterTable FT  ON BRD1.ID_BRD = FT.ID_BRD
        WHERE INV.POSTING_DATE_INV &gt;= #{startDate} AND INV.POSTING_DATE_INV &lt;=  #{endDate})
        AS Purchase1

        IF(#{userDesgId} = '2B264AFB-E2FD-483C-BD4C-C36A4E352FC5')--BM
        BEGIN
        SELECT distinct * FROM #Purchase1 WHERE CostCenterID IN (SELECT DISTINCT ID_CCM_CBR FROM BRANDMANAGER_BRAND_BBR BBR
        JOIN COSTCENTER_BRAND_CBR CBR ON BBR.ID_BRD_BBR = CBR.ID_BRD_CBR WHERE BBR.ID_USR_BBR = #{userId}
        UNION SELECT ID_BRD_BBR FROM BRANDMANAGER_BRAND_BBR WHERE ID_USR_BBR = #{userId})
        END
        ELSE IF(#{userDesgId} = '88F90CCF-FB95-42DB-AECF-B4C5E8C25BE6')--BEX
        BEGIN

        SELECT distinct * FROM #Purchase1 WHERE CostCenterID IN (
        SELECT DISTINCT CBR.ID_CCM_CBR FROM COSTCENTER_BRAND_CBR CBR
        JOIN TEAM_BRAND_TBR TBR ON CBR.ID_BRD_CBR = TBR.ID_BRD_TBR
        JOIN TEAM_LEGAL_ENTITY_TET TET ON TBR.ID_TEM_TBR = TET.ID_TEM_TET
        join USER_LEGAL_ENTITY_ULE ULE on TET.ID_ETY_TET = ULE.ID_ETY_ULE
        join USER_MASTER_USR USR on USR.ID_USR= ULE.ID_USR_ULE
        WHERE USR.ID_USR = #{userId}
        UNION
        SELECT DISTINCT TBR.ID_BRD_TBR FROM TEAM_BRAND_TBR TBR
        JOIN TEAM_LEGAL_ENTITY_TET TET ON TBR.ID_TEM_TBR = TET.ID_TEM_TET
        join USER_LEGAL_ENTITY_ULE ULE on TET.ID_ETY_TET = ULE.ID_ETY_ULE
        join USER_MASTER_USR USR on USR.ID_USR= ULE.ID_USR_ULE
        WHERE USR.ID_USR = #{userId}
        )

        END
        ELSE--HUB
        BEGIN
        SELECT distinct * FROM #Purchase1
        END

        DROP TABLE #FilterTable
        DROP TABLE #Purchase1


    </select>



<!--    <select id="getReportDispatches" resultType="com.squer.promobee.controller.dto.DispatchesReportDTO" parameterType = "map" statementType = "CALLABLE">-->
<!--        {call PROC_ReportDispatch (#{Filter, jdbcType = INTEGER , mode = IN},#{StartDate, jdbcType = VARCHAR, mode = IN}, #{EndDate, jdbcType = VARCHAR, mode = IN}, #{UserID, jdbcType = VARCHAR, mode = IN},-->
<!--        #{UserDesgID, jdbcType = VARCHAR, mode = IN},#{BusinessUnit, jdbcType = VARCHAR, mode = IN},#{Division, jdbcType = VARCHAR, mode = IN},-->
<!--        #{filterplan, jdbcType = INTEGER , mode = IN} )}-->
<!--    </select>-->

    <select id="getReportDispatches" resultType="com.squer.promobee.controller.dto.DispatchesReportDTO" >
        if(#{filterplan}=2)
        begin


        SELECT * INTO #FilterTable FROM
        (
        select  BRD.ID_BRD,BUM.NAME_BUM as 'businessUnit', DIM.NAME_DIM as 'divison' from
        BRAND_MASTER_BRD BRD
        join DIVISION_BRAND_DBR DBR on BRD.ID_BRD= dbr.ID_BRD_DBR
        join DIVISION_MASTER_DIM DIM on dbr.ID_DIM_DBR =Dim.ID_DIM
        join BU_MASTER_BUM BUM on DIM.ID_BUM_DIM = BUM.ID_BUM
        where DIM.ID_BUM_DIM  in (<foreach item="item" index="index" collection="BusinessUnit"
                                           separator=",">
        #{item}
    </foreach>)
        and  DIM.ID_DIM  in (<foreach item="item" index="index" collection="Division"
                                      separator=",">
        #{item}
    </foreach>)

        ) AS FilterResult


        IF(#{Filter} = 1)
        BEGIN
        SELECT * INTO #TempDispatchReport FROM(
        SELECT  distinct FT.businessUnit,FT.divison,RCT.ID_RCT AS RecipientID, RCT.NAME_RCT AS recipientName, RCT.CODE_RCT AS recipientCode,rct.state_rct as 'State',rct.zone_rct as 'Zone', ITM.CODE_ITM AS productCode,
        ITM.NAME_ITM AS productName, IND.quantity_IND AS quantity,ROUND(SUM(IND.VALUE_IND),0) AS amount,  CONVERT(NVARCHAR,INH.CREATED_ON_INH,103) AS invoiceDate,
        RCT.ID_TEM_RCT 'TeamID',DIP.ID_OWNER_USR_DIP 'PlanOwnerID',tem.NAME_TEM 'teamName',ulv.NAME_ULV 'desigation',inh.INVOICE_NO_INH 'invoiceNo' ,itc.NAME_ITC as ItemCategory
        FROM INVOICE_HEADER_INH INH
        JOIN RECIPIENT_MASTER_RCT RCT ON INH.ID_RCT_INH = RCT.ID_RCT
        Join USER_LOV_ULV ulv on rct.ID_DESG_ULV_RCT=ulv.ID_ULV
        join TEAM_MASTER_TEM tem on inh.ID_TEM_INH=tem.ID_TEM
        JOIN INVOICE_DETAIL_IND IND ON INH.ID_INH = IND.ID_INH_IND
        JOIN DISPATCH_DETAIL_DID DID ON IND.ID_DID_IND = DID.ID_DID
        JOIN DISPATCH_PLAN_DIP DIP ON DID.ID_DIP_DID = DIP.ID_DIP
        join INVENTORY_INV INV on IND.ID_INV_IND=INV.ID_INV
        JOIN ITEM_MASTER_ITM ITM ON INV.ID_ITM_INV = ITM.ID_ITM
        JOIN ITEM_CATEGORY_MASTER_ITC ITC ON ITM.ID_ITC_ITM = ITC.ID_ITC
        JOIN COST_CENTER_MASTER_CCM CCM ON ITM.ID_CCM_ITM = CCM.ID_CCM
        join COSTCENTER_BRAND_CBR CBR on CCM.ID_CCM=CBR.ID_CCM_CBR
        JOIN BRAND_MASTER_BRD BRD ON CBR.ID_BRD_CBR = BRD.ID_BRD
        JOIN #FilterTable FT on BRD.ID_BRD  = FT.ID_BRD
        WHERE CAST(INH.CREATED_ON_INH AS DATE) &gt;= CAST(#{StartDate} AS DATE) AND CAST(INH.CREATED_ON_INH AS DATE) &lt;= CAST(#{EndDate} AS DATE)
        AND INH.ID_STATUS_SLV_INH = '00000000-0000-0000-0000-000000000027'
        AND IND.ID_DID_IND != '00000000-0000-0000-0000-000000000000'
        GROUP BY  FT.businessUnit,FT.divison,RCT.ID_RCT,RCT.NAME_RCT,RCT.CODE_RCT,RCT.STATE_RCT,RCT.ZONE_RCT,ITM.CODE_ITM,ITM.NAME_ITM,IND.quantity_IND,INH.CREATED_ON_INH,RCT.ID_TEM_RCT,DIP.ID_OWNER_USR_DIP,tem.NAME_TEM,ulv.NAME_ULV,inh.INVOICE_NO_INH,itc.NAME_ITC
        UNION ALL
        SELECT  distinct FT.businessUnit,FT.divison,RCT.ID_RCT AS RecipientID, RCT.NAME_RCT AS recipientName, RCT.CODE_RCT AS recipientCode,rct.state_rct as 'State',rct.zone_rct as 'Zone', SMP.LMID_SMP AS productCode,
        SMP.NAME_SMP AS productName, IND.quantity_IND AS quantity, round(SUM(IND.VALUE_IND),0) AS amount,  CONVERT(NVARCHAR,INH.CREATED_ON_INH,103) AS invoiceDate,
        RCT.ID_TEM_RCT 'TeamID',DIP.ID_OWNER_USR_DIP 'PlanOwnerID',tem.NAME_TEM 'teamName',ulv.NAME_ULV 'desigation' ,inh.INVOICE_NO_INH 'invoiceNo',itc.NAME_ITC as 'ItemCategory'
        FROM INVOICE_HEADER_INH INH
        JOIN RECIPIENT_MASTER_RCT RCT ON INH.ID_RCT_INH = RCT.ID_RCT
        Join USER_LOV_ULV ulv on rct.ID_DESG_ULV_RCT=ulv.ID_ULV
        join TEAM_MASTER_TEM tem on inh.ID_TEM_INH=tem.ID_TEM
        JOIN INVOICE_DETAIL_IND IND ON INH.ID_INH = IND.ID_INH_IND
        join INVENTORY_INV inv on ind.ID_INV_IND=inv.ID_INV
        join ITEM_CATEGORY_MASTER_ITC itc on inv.ID_ITC_INV=itc.ID_ITC
        JOIN DISPATCH_DETAIL_DID DID ON IND.ID_DID_IND = DID.ID_DID
        JOIN DISPATCH_PLAN_DIP DIP ON DID.ID_DIP_DID = DIP.ID_DIP
        JOIN SAMPLE_MASTER_SMP SMP ON IND.ID_ITM_IND = SMP.ID_SMP
        JOIN BRAND_MASTER_BRD BRD ON SMP.ID_BRD_SMP = BRD.ID_BRD
        JOIN  #FilterTable FT  ON BRD.ID_BRD = FT.ID_BRD
        WHERE CAST(INH.CREATED_ON_INH AS DATE) &gt;= CAST(#{StartDate AS DATE) AND CAST(INH.CREATED_ON_INH AS DATE) &lt;= CAST(#{EndDate} AS DATE)
        AND INH.ID_STATUS_SLV_INH = '00000000-0000-0000-0000-000000000027'
        AND IND.ID_DID_IND != '00000000-0000-0000-0000-000000000000'
        GROUP BY  FT.businessUnit,FT.divison,RCT.ID_RCT,RCT.NAME_RCT,RCT.CODE_RCT,RCT.STATE_RCT,RCT.ZONE_RCT,SMP.LMID_SMP,SMP.NAME_SMP,IND.quantity_IND,INH.CREATED_ON_INH,RCT.ID_TEM_RCT,DIP.ID_OWNER_USR_DIP,tem.NAME_TEM,ulv.NAME_ULV,inh.INVOICE_NO_INH,itc.NAME_ITC
        ) AS TempDispatchReport
        IF(#{UserDesgID} = '2B264AFB-E2FD-483C-BD4C-C36A4E352FC5')--BM
        BEGIN
        SELECT * FROM #TempDispatchReport WHERE PlanOwnerID = #{UserID} ORDER BY productName
        END
        ELSE IF(#{UserDesgID} = '88F90CCF-FB95-42DB-AECF-B4C5E8C25BE6')--BEX
        BEGIN
        SELECT * FROM #TempDispatchReport WHERE TeamID IN(
        SELECT DISTINCT TET.ID_TEM_TET FROM TEAM_LEGAL_ENTITY_TET TET
        join USER_LEGAL_ENTITY_ULE ULE on TET.ID_ETY_TET = ULE.ID_ETY_ULE
        join USER_MASTER_USR USR on USR.ID_USR= ULE.ID_USR_ULE
        WHERE USR.ID_USR = #{UserID}
        )
        ORDER BY productName
        END
        ELSE--HUB
        BEGIN
        SELECT * FROM #TempDispatchReport ORDER BY productName
        END
        DROP TABLE #TempDispatchReport
        END
        ELSE
        BEGIN
        SELECT * INTO #TempDispatchReport1 FROM(
        SELECT distinct FT.businessUnit,RCT.ID_RCT AS RecipientID, RCT.NAME_RCT AS recipientName, RCT.CODE_RCT AS recipientCode,rct.state_rct as 'State',rct.zone_rct as 'Zone', ITM.CODE_ITM AS productCode,
        ITM.NAME_ITM AS productName, IND.quantity_IND AS quantity,Round(SUM(IND.VALUE_IND),0) AS amount, CONVERT(NVARCHAR,INH.CREATED_ON_INH,103) AS invoiceDate,
        RCT.ID_TEM_RCT 'TeamID',DIP.ID_OWNER_USR_DIP 'PlanOwnerID',tem.NAME_TEM 'teamName',ulv.NAME_ULV 'desigation' ,inh.INVOICE_NO_INH 'invoiceNo',itc.NAME_ITC as 'ItemCategory'
        FROM INVOICE_HEADER_INH INH
        JOIN RECIPIENT_MASTER_RCT RCT ON INH.ID_RCT_INH = RCT.ID_RCT
        Join USER_LOV_ULV ulv on rct.ID_DESG_ULV_RCT=ulv.ID_ULV
        join TEAM_MASTER_TEM tem on inh.ID_TEM_INH=tem.ID_TEM
        JOIN INVOICE_DETAIL_IND IND ON INH.ID_INH = IND.ID_INH_IND
        JOIN DISPATCH_DETAIL_DID DID ON IND.ID_DID_IND = DID.ID_DID
        JOIN DISPATCH_PLAN_DIP DIP ON DID.ID_DIP_DID = DIP.ID_DIP
        join INVENTORY_INV INV on IND.ID_INV_IND=INV.ID_INV
        JOIN ITEM_MASTER_ITM ITM ON INV.ID_ITM_INV = ITM.ID_ITM
        JOIN ITEM_CATEGORY_MASTER_ITC ITC ON ITM.ID_ITC_ITM = ITC.ID_ITC
        JOIN COST_CENTER_MASTER_CCM CCM ON ITM.ID_CCM_ITM = CCM.ID_CCM
        join COSTCENTER_BRAND_CBR CBR on CCM.ID_CCM=CBR.ID_CCM_CBR
        JOIN BRAND_MASTER_BRD BRD ON CBR.ID_BRD_CBR = BRD.ID_BRD
        JOIN #FilterTable FT on BRD.ID_BRD  = FT.ID_BRD
        WHERE CAST(INH.CREATED_ON_INH AS DATE) &gt;= CAST(#{StartDate} AS DATE) AND CAST(INH.CREATED_ON_INH AS DATE) &lt;= CAST(#{EndDate} AS DATE)
        AND INH.ID_STATUS_SLV_INH = '00000000-0000-0000-0000-000000000027'
        AND IND.ID_DID_IND != '00000000-0000-0000-0000-000000000000'
        GROUP BY FT.businessUnit,FT.divison,RCT.ID_RCT,RCT.NAME_RCT,RCT.CODE_RCT,RCT.STATE_RCT,RCT.ZONE_RCT,ITM.CODE_ITM,ITM.NAME_ITM,IND.quantity_IND,INH.CREATED_ON_INH,RCT.ID_TEM_RCT,DIP.ID_OWNER_USR_DIP,tem.NAME_TEM,ulv.NAME_ULV,inh.INVOICE_NO_INH,itc.NAME_ITC
        UNION
        SELECT distinct FT.businessUnit,RCT.ID_RCT AS RecipientID, RCT.NAME_RCT AS recipientName, RCT.CODE_RCT AS recipientCode,rct.state_rct as 'State',rct.zone_rct as 'Zone', SMP.LMID_SMP AS productCode,
        SMP.NAME_SMP AS productName, IND.quantity_IND AS quantity,Round(SUM(IND.VALUE_IND),0) AS amount, CONVERT(NVARCHAR,INH.CREATED_ON_INH,103) AS invoiceDate,
        RCT.ID_TEM_RCT 'TeamID',DIP.ID_OWNER_USR_DIP 'PlanOwnerID',tem.NAME_TEM 'teamName',ulv.NAME_ULV 'desigation' ,inh.INVOICE_NO_INH 'invoiceNo',itc.NAME_ITC as 'ItemCategory'
        FROM INVOICE_HEADER_INH INH
        JOIN RECIPIENT_MASTER_RCT RCT ON INH.ID_RCT_INH = RCT.ID_RCT
        Join USER_LOV_ULV ulv on rct.ID_DESG_ULV_RCT=ulv.ID_ULV
        join TEAM_MASTER_TEM tem on inh.ID_TEM_INH=tem.ID_TEM
        JOIN INVOICE_DETAIL_IND IND ON INH.ID_INH = IND.ID_INH_IND
        join INVENTORY_INV inv on ind.ID_INV_IND=inv.ID_INV
        join ITEM_CATEGORY_MASTER_ITC itc on itc.ID_ITC=inv.ID_ITC_INV
        JOIN DISPATCH_DETAIL_DID DID ON IND.ID_DID_IND = DID.ID_DID
        JOIN DISPATCH_PLAN_DIP DIP ON DID.ID_DIP_DID = DIP.ID_DIP
        JOIN SAMPLE_MASTER_SMP SMP ON IND.ID_ITM_IND = SMP.ID_SMP
        JOIN BRAND_MASTER_BRD BRD ON SMP.ID_BRD_SMP = BRD.ID_BRD
        JOIN  #FilterTable FT  ON BRD.ID_BRD = FT.ID_BRD
        WHERE CAST(INH.CREATED_ON_INH AS DATE) &gt;= CAST(#{StartDate} AS DATE) AND CAST(INH.CREATED_ON_INH AS DATE) &lt;= CAST(#{EndDate} AS DATE)
        AND INH.ID_STATUS_SLV_INH = '00000000-0000-0000-0000-000000000027'
        AND IND.ID_DID_IND != '00000000-0000-0000-0000-000000000000'
        GROUP BY FT.businessUnit,FT.divison,RCT.ID_RCT,RCT.NAME_RCT,RCT.CODE_RCT,RCT.STATE_RCT,RCT.ZONE_RCT,SMP.LMID_SMP,SMP.NAME_SMP,IND.quantity_IND,INH.CREATED_ON_INH,RCT.ID_TEM_RCT,DIP.ID_OWNER_USR_DIP,tem.NAME_TEM,ulv.NAME_ULV ,inh.INVOICE_NO_INH,itc.NAME_ITC
        ) AS TempDispatchReport1


        IF(#{UserDesgID} = '2B264AFB-E2FD-483C-BD4C-C36A4E352FC5')--BM
        BEGIN
        SELECT distinct * FROM #TempDispatchReport1 WHERE PlanOwnerID = #{UserID} ORDER BY productName
        END
        ELSE IF(#{UserDesgID} = '88F90CCF-FB95-42DB-AECF-B4C5E8C25BE6')--BEX
        BEGIN
        SELECT distinct * FROM #TempDispatchReport1 WHERE TeamID IN
        (SELECT DISTINCT TET.ID_TEM_TET FROM TEAM_LEGAL_ENTITY_TET TET
        join USER_LEGAL_ENTITY_ULE ULE on TET.ID_ETY_TET = ULE.ID_ETY_ULE
        join USER_MASTER_USR USR on USR.ID_USR= ULE.ID_USR_ULE
        WHERE USR.ID_USR = #{UserID}
        )
        ORDER BY productName
        END
        ELSE--HUB
        BEGIN
        SELECT distinct * FROM #TempDispatchReport1 ORDER BY productName
        END

        drop table #FilterTable
        DROP TABLE #TempDispatchReport1
        END
        END
        ELSE
        begin
        IF(#{Filter} = 1)
        BEGIN
        SELECT * INTO #FilterTable1 FROM
        (
        select  BRD.ID_BRD,BUM.NAME_BUM as 'businessUnit', DIM.NAME_DIM as 'divison' from
        BRAND_MASTER_BRD BRD
        join DIVISION_BRAND_DBR DBR on BRD.ID_BRD= dbr.ID_BRD_DBR
        join DIVISION_MASTER_DIM DIM on dbr.ID_DIM_DBR =Dim.ID_DIM
        join BU_MASTER_BUM BUM on DIM.ID_BUM_DIM = BUM.ID_BUM
        where DIM.ID_BUM_DIM  in (<foreach item="item" index="index" collection="BusinessUnit"
                                           separator=",">
        #{item}
    </foreach>)
        and  DIM.ID_DIM  in (<foreach item="item" index="index" collection="Division"
                                      separator=",">
        #{item}
    </foreach>)

        ) AS FilterResult
        SELECT * INTO #TempDispatchReport2 FROM(
        SELECT  distinct FT.businessUnit,FT.divison,RCT.ID_RCT AS RecipientID, RCT.NAME_RCT AS recipientName, RCT.CODE_RCT AS recipientCode,rct.state_rct as 'State',rct.zone_rct as 'Zone', ITM.CODE_ITM AS productCode,
        ITM.NAME_ITM AS productName, IND.quantity_IND AS quantity,ROUND(SUM(IND.VALUE_IND),0) AS amount,  CONVERT(NVARCHAR,INH.CREATED_ON_INH,103) AS invoiceDate,
        RCT.ID_TEM_RCT 'TeamID',DIP.ID_OWNER_USR_DIP 'PlanOwnerID',tem.NAME_TEM 'teamName',ulv.NAME_ULV 'desigation',inh.INVOICE_NO_INH 'invoiceNo' ,itc.NAME_ITC as 'ItemCategory'
        FROM INVOICE_HEADER_INH INH
        JOIN RECIPIENT_MASTER_RCT RCT ON INH.ID_RCT_INH = RCT.ID_RCT
        Join USER_LOV_ULV ulv on rct.ID_DESG_ULV_RCT=ulv.ID_ULV
        join TEAM_MASTER_TEM tem on inh.ID_TEM_INH=tem.ID_TEM
        JOIN INVOICE_DETAIL_IND IND ON INH.ID_INH = IND.ID_INH_IND
        JOIN DISPATCH_DETAIL_DID DID ON IND.ID_DID_IND = DID.ID_DID
        JOIN DISPATCH_PLAN_DIP DIP ON DID.ID_DIP_DID = DIP.ID_DIP
        join INVENTORY_INV INV on IND.ID_INV_IND=INV.ID_INV
        JOIN ITEM_MASTER_ITM ITM ON INV.ID_ITM_INV = ITM.ID_ITM
        JOIN ITEM_CATEGORY_MASTER_ITC ITC ON ITM.ID_ITC_ITM = ITC.ID_ITC
        JOIN COST_CENTER_MASTER_CCM CCM ON ITM.ID_CCM_ITM = CCM.ID_CCM
        join COSTCENTER_BRAND_CBR CBR on CCM.ID_CCM=CBR.ID_CCM_CBR
        JOIN BRAND_MASTER_BRD BRD ON CBR.ID_BRD_CBR = BRD.ID_BRD
        JOIN #FilterTable1 FT on BRD.ID_BRD  = FT.ID_BRD
        WHERE CAST(INH.CREATED_ON_INH AS DATE) &gt;= CAST(#{StartDate} AS DATE) AND CAST(INH.CREATED_ON_INH AS DATE) &lt;= CAST(#{EndDate} AS DATE)
        AND INH.ID_STATUS_SLV_INH = '00000000-0000-0000-0000-000000000027'
        AND IND.ID_DID_IND != '00000000-0000-0000-0000-000000000000'
        AND DIP.IS_SPECIAL_DIP=#{filterplan}
        GROUP BY  FT.businessUnit,FT.divison,RCT.ID_RCT,RCT.NAME_RCT,RCT.CODE_RCT,RCT.STATE_RCT,RCT.ZONE_RCT,ITM.CODE_ITM,ITM.NAME_ITM,IND.quantity_IND,INH.CREATED_ON_INH,RCT.ID_TEM_RCT,DIP.ID_OWNER_USR_DIP,tem.NAME_TEM,ulv.NAME_ULV,inh.INVOICE_NO_INH,itc.NAME_ITC
        UNION ALL
        SELECT  distinct FT.businessUnit,FT.divison,RCT.ID_RCT AS RecipientID, RCT.NAME_RCT AS recipientName, RCT.CODE_RCT AS recipientCode,rct.state_rct as 'State',rct.zone_rct as 'Zone', SMP.LMID_SMP AS productCode,
        SMP.NAME_SMP AS productName, IND.quantity_IND AS quantity, round(SUM(IND.VALUE_IND),0) AS amount,  CONVERT(NVARCHAR,INH.CREATED_ON_INH,103) AS invoiceDate,
        RCT.ID_TEM_RCT 'TeamID',DIP.ID_OWNER_USR_DIP 'PlanOwnerID',tem.NAME_TEM 'teamName',ulv.NAME_ULV 'desigation' ,inh.INVOICE_NO_INH 'invoiceNo',itc.NAME_ITC as 'ItemCategory'
        FROM INVOICE_HEADER_INH INH
        JOIN RECIPIENT_MASTER_RCT RCT ON INH.ID_RCT_INH = RCT.ID_RCT
        Join USER_LOV_ULV ulv on rct.ID_DESG_ULV_RCT=ulv.ID_ULV
        join TEAM_MASTER_TEM tem on inh.ID_TEM_INH=tem.ID_TEM
        JOIN INVOICE_DETAIL_IND IND ON INH.ID_INH = IND.ID_INH_IND
        join INVENTORY_INV inv on ind.ID_INV_IND=inv.ID_INV
        join ITEM_CATEGORY_MASTER_ITC itc on inv.ID_ITC_INV=itc.ID_ITC
        JOIN DISPATCH_DETAIL_DID DID ON IND.ID_DID_IND = DID.ID_DID
        JOIN DISPATCH_PLAN_DIP DIP ON DID.ID_DIP_DID = DIP.ID_DIP
        JOIN SAMPLE_MASTER_SMP SMP ON IND.ID_ITM_IND = SMP.ID_SMP
        JOIN BRAND_MASTER_BRD BRD ON SMP.ID_BRD_SMP = BRD.ID_BRD
        JOIN  #FilterTable1 FT  ON BRD.ID_BRD = FT.ID_BRD
        WHERE CAST(INH.CREATED_ON_INH AS DATE) &gt;= CAST(#{StartDate} AS DATE) AND CAST(INH.CREATED_ON_INH AS DATE) &lt;= CAST(#{EndDate} AS DATE)
        AND INH.ID_STATUS_SLV_INH = '00000000-0000-0000-0000-000000000027'
        AND IND.ID_DID_IND != '00000000-0000-0000-0000-000000000000'
        AND DIP.IS_SPECIAL_DIP=#{filterplan}
        GROUP BY  FT.businessUnit,FT.divison,RCT.ID_RCT,RCT.NAME_RCT,RCT.CODE_RCT,RCT.STATE_RCT,RCT.ZONE_RCT,SMP.LMID_SMP,SMP.NAME_SMP,IND.quantity_IND,INH.CREATED_ON_INH,RCT.ID_TEM_RCT,DIP.ID_OWNER_USR_DIP,tem.NAME_TEM,ulv.NAME_ULV,inh.INVOICE_NO_INH,itc.NAME_ITC
        ) AS TempDispatchReport2
        IF(#{UserDesgID} = '2B264AFB-E2FD-483C-BD4C-C36A4E352FC5')--BM
        BEGIN
        SELECT * FROM #TempDispatchReport2 WHERE PlanOwnerID = #{UserID} ORDER BY productName
        END
        ELSE IF(#{UserDesgID} = '88F90CCF-FB95-42DB-AECF-B4C5E8C25BE6')--BEX
        BEGIN
        SELECT * FROM #TempDispatchReport2 WHERE TeamID IN(
        SELECT DISTINCT TET.ID_TEM_TET FROM TEAM_LEGAL_ENTITY_TET TET
        join USER_LEGAL_ENTITY_ULE ULE on TET.ID_ETY_TET = ULE.ID_ETY_ULE
        join USER_MASTER_USR USR on USR.ID_USR= ULE.ID_USR_ULE
        WHERE USR.ID_USR = #{UserID}
        )
        ORDER BY productName
        END
        ELSE--HUB
        BEGIN
        SELECT * FROM #TempDispatchReport2 ORDER BY productName
        END
        DROP TABLE #TempDispatchReport2
        END
        ELSE
        BEGIN
        SELECT * INTO #TempDispatchReport3 FROM(
        SELECT distinct FT.businessUnit,RCT.ID_RCT AS RecipientID, RCT.NAME_RCT AS recipientName, RCT.CODE_RCT AS recipientCode,rct.state_rct as 'State',rct.zone_rct as 'Zone', ITM.CODE_ITM AS productCode,
        ITM.NAME_ITM AS productName, IND.quantity_IND AS quantity,Round(SUM(IND.VALUE_IND),0) AS amount, CONVERT(NVARCHAR,INH.CREATED_ON_INH,103) AS invoiceDate,
        RCT.ID_TEM_RCT 'TeamID',DIP.ID_OWNER_USR_DIP 'PlanOwnerID',tem.NAME_TEM 'teamName',ulv.NAME_ULV 'desigation' ,inh.INVOICE_NO_INH 'invoiceNo',itc.NAME_ITC as 'ItemCategory'
        FROM INVOICE_HEADER_INH INH
        JOIN RECIPIENT_MASTER_RCT RCT ON INH.ID_RCT_INH = RCT.ID_RCT
        Join USER_LOV_ULV ulv on rct.ID_DESG_ULV_RCT=ulv.ID_ULV
        join TEAM_MASTER_TEM tem on inh.ID_TEM_INH=tem.ID_TEM
        JOIN INVOICE_DETAIL_IND IND ON INH.ID_INH = IND.ID_INH_IND
        JOIN DISPATCH_DETAIL_DID DID ON IND.ID_DID_IND = DID.ID_DID
        JOIN DISPATCH_PLAN_DIP DIP ON DID.ID_DIP_DID = DIP.ID_DIP
        join INVENTORY_INV INV on IND.ID_INV_IND=INV.ID_INV
        JOIN ITEM_MASTER_ITM ITM ON INV.ID_ITM_INV = ITM.ID_ITM
        JOIN ITEM_CATEGORY_MASTER_ITC ITC ON ITM.ID_ITC_ITM = ITC.ID_ITC
        JOIN COST_CENTER_MASTER_CCM CCM ON ITM.ID_CCM_ITM = CCM.ID_CCM
        join COSTCENTER_BRAND_CBR CBR on CCM.ID_CCM=CBR.ID_CCM_CBR
        JOIN BRAND_MASTER_BRD BRD ON CBR.ID_BRD_CBR = BRD.ID_BRD
        JOIN #FilterTable1 FT on BRD.ID_BRD  = FT.ID_BRD
        WHERE CAST(INH.CREATED_ON_INH AS DATE) &gt;= CAST(#{StartDate} AS DATE) AND CAST(INH.CREATED_ON_INH AS DATE) &lt;= CAST(#{EndDate} AS DATE)
        AND INH.ID_STATUS_SLV_INH = '00000000-0000-0000-0000-000000000027'
        AND IND.ID_DID_IND != '00000000-0000-0000-0000-000000000000'
        AND DIP.IS_SPECIAL_DIP=#{filterplan}
        GROUP BY FT.businessUnit,FT.divison,RCT.ID_RCT,RCT.NAME_RCT,RCT.CODE_RCT,RCT.STATE_RCT,RCT.ZONE_RCT,ITM.CODE_ITM,ITM.NAME_ITM,IND.quantity_IND,INH.CREATED_ON_INH,RCT.ID_TEM_RCT,DIP.ID_OWNER_USR_DIP,tem.NAME_TEM,ulv.NAME_ULV,inh.INVOICE_NO_INH,itc.NAME_ITC
        UNION
        SELECT distinct FT.businessUnit,RCT.ID_RCT AS RecipientID, RCT.NAME_RCT AS recipientName, RCT.CODE_RCT AS recipientCode, rct.state_rct as 'State',rct.zone_rct as 'Zone',SMP.LMID_SMP AS productCode,
        SMP.NAME_SMP AS productName, IND.quantity_IND AS quantity,Round(SUM(IND.VALUE_IND),0) AS amount, CONVERT(NVARCHAR,INH.CREATED_ON_INH,103) AS invoiceDate,
        RCT.ID_TEM_RCT 'TeamID',DIP.ID_OWNER_USR_DIP 'PlanOwnerID',tem.NAME_TEM 'teamName',ulv.NAME_ULV 'desigation' ,inh.INVOICE_NO_INH 'invoiceNo',itc.NAME_ITC as 'ItemCategory'
        FROM INVOICE_HEADER_INH INH
        JOIN RECIPIENT_MASTER_RCT RCT ON INH.ID_RCT_INH = RCT.ID_RCT
        Join USER_LOV_ULV ulv on rct.ID_DESG_ULV_RCT=ulv.ID_ULV
        join TEAM_MASTER_TEM tem on inh.ID_TEM_INH=tem.ID_TEM
        JOIN INVOICE_DETAIL_IND IND ON INH.ID_INH = IND.ID_INH_IND
        join INVENTORY_INV inv on ind.ID_INV_IND=inv.ID_INV
        join ITEM_CATEGORY_MASTER_ITC itc on itc.ID_ITC=inv.ID_ITC_INV
        JOIN DISPATCH_DETAIL_DID DID ON IND.ID_DID_IND = DID.ID_DID
        JOIN DISPATCH_PLAN_DIP DIP ON DID.ID_DIP_DID = DIP.ID_DIP
        JOIN SAMPLE_MASTER_SMP SMP ON IND.ID_ITM_IND = SMP.ID_SMP
        JOIN BRAND_MASTER_BRD BRD ON SMP.ID_BRD_SMP = BRD.ID_BRD
        JOIN  #FilterTable1 FT  ON BRD.ID_BRD = FT.ID_BRD
        WHERE CAST(INH.CREATED_ON_INH AS DATE) &gt;= CAST(#{StartDate} AS DATE) AND CAST(INH.CREATED_ON_INH AS DATE) &lt;= CAST(#{EndDate} AS DATE)
        AND INH.ID_STATUS_SLV_INH = '00000000-0000-0000-0000-000000000027'
        AND IND.ID_DID_IND != '00000000-0000-0000-0000-000000000000'
        AND DIP.IS_SPECIAL_DIP=#{filterplan}
        GROUP BY FT.businessUnit,FT.divison,RCT.ID_RCT,RCT.NAME_RCT,RCT.CODE_RCT,RCT.STATE_RCT,RCT.ZONE_RCT,SMP.LMID_SMP,SMP.NAME_SMP,IND.quantity_IND,INH.CREATED_ON_INH,RCT.ID_TEM_RCT,DIP.ID_OWNER_USR_DIP,tem.NAME_TEM,ulv.NAME_ULV ,inh.INVOICE_NO_INH,itc.NAME_ITC
        ) AS TempDispatchReport3


        IF(#{UserDesgID} = '2B264AFB-E2FD-483C-BD4C-C36A4E352FC5')--BM
        BEGIN
        SELECT distinct * FROM #TempDispatchReport3 WHERE PlanOwnerID = #{UserID} ORDER BY productName
        END
        ELSE IF(#{UserDesgID} = '88F90CCF-FB95-42DB-AECF-B4C5E8C25BE6')--BEX
        BEGIN
        SELECT distinct * FROM #TempDispatchReport3 WHERE TeamID IN
        (SELECT DISTINCT TET.ID_TEM_TET FROM TEAM_LEGAL_ENTITY_TET TET
        join USER_LEGAL_ENTITY_ULE ULE on TET.ID_ETY_TET = ULE.ID_ETY_ULE
        join USER_MASTER_USR USR on USR.ID_USR= ULE.ID_USR_ULE
        WHERE USR.ID_USR = #{UserID}
        )
        ORDER BY productName
        END
        ELSE--HUB
        BEGIN
        SELECT distinct * FROM #TempDispatchReport3 ORDER BY productName
        END

        DROP TABLE #FilterTable1
        DROP TABLE #TempDispatchReport3
        END
        end
    </select>








<!--    <select id="getReportDispatchRegister" resultType="com.squer.promobee.controller.dto.DispatchRegisterReportDTO" parameterType = "map" statementType = "CALLABLE">-->
<!--        { call PROC_ReportDispatchRegister (#{StartDate, jdbcType = VARCHAR, mode = IN}, #{EndDate, jdbcType = VARCHAR, mode = IN}, #{UserID, jdbcType = VARCHAR, mode = IN},-->
<!--        #{UserDesgID, jdbcType = VARCHAR, mode = IN},#{BusinessUnit, jdbcType = VARCHAR, mode = IN}, #{Division, jdbcType = VARCHAR, mode = IN},-->
<!--        #{Team, jdbcType = VARCHAR, mode = IN},#{StatusID, jdbcType = VARCHAR, mode = IN}, #{Filterplan, jdbcType = INTEGER, mode = IN}) }-->
<!--    </select>-->

<!--    <select id="getReportDispatchRegister" resultType="com.squer.promobee.controller.dto.DispatchRegisterReportDTO" >-->

<!--        IF (#{filterplan}=2)-->
<!--        begin-->
<!--        SELECT * INTO #FilterTable FROM-->
<!--        (-->
<!--        select TEM.ID_TEM,BUM.NAME_BUM as 'businessUnit', DIM.NAME_DIM as 'division' from-->
<!--        TEAM_MASTER_TEM TEM join division_MASTER_DIM DIM on TEM.ID_DIM_TEM =Dim.ID_DIM-->
<!--        join BU_MASTER_BUM BUM on DIM.ID_BUM_DIM = BUM.ID_BUM-->
<!--        where DIM.ID_BUM_DIM  in (<foreach item="item" index="index" collection="BusinessUnit"-->
<!--                                           separator=",">-->
<!--        #{item}-->
<!--    </foreach>)-->
<!--        and  DIM.ID_DIM  in (<foreach item="item" index="index" collection="Division"-->
<!--                                      separator=",">-->
<!--        #{item}-->
<!--    </foreach>)-->
<!--        TEM.ID_TEM  in (<foreach item="item" index="index" collection="Team"-->
<!--                                 separator=",">-->
<!--        #{item}-->
<!--    </foreach>)-->
<!--        ) AS FilterResult-->

<!--        SELECT * INTO #TempDispatchRegisterReport FROM(-->
<!--        SELECT  FT.businessUnit,FT.division, INH.ID_INH 'InvoiceHeaderID',INHDIP.ID_OWNER_USR_DIP 'PlanOwnerID',INH.LR_NUMBER_INH AS lrNo, TRN.NAME_TRN AS courierName, INH.NO_OF_BOXES_INH AS noBoxes,-->
<!--        INH.weight_INH AS 'weights',	INH.INVOICE_NO_INH AS invoiceNo,ROUND(ISNULL(INH.SAMPLE_value_INH,0) + ISNUll(INH.OTHER_ITEM_value_INH,0),2) as 'values',-->
<!--        ROUND(ISNULL(INH.SAMPLE_value_INH,0),2)  as 'sampleValue', round(ISNUll(INH.OTHER_ITEM_value_INH,0),2) as 'itemValue',-->
<!--        CONVERT(nvarchar(100),INH.CREATED_ON_INH, 103) AS invoiceDate,-->
<!--        RCT.ID_RCT 'recipientID',RCT.NAME_RCT AS recipient, RCT.CODE_RCT AS employeeCode,-->
<!--        INH.address_LINE_1_INH + ' ' + INH.address_LINE_2_INH AS 'address', INH.address_city_INH AS city, INH.address_state_INH AS 'state',-->
<!--        INH.address_zip_INH AS zip, INH.PHONE_INH AS mobileNo,TEM.ID_TEM 'TeamID',TEM.NAME_TEM AS teamName,TRD.DELIVERED_TO_NAME_TRD as 'nameofReceiver',-->
<!--        CONVERT(nvarchar(100),TRD.ACTUAL_DELIVERY_DATE_TRD, 103) as 'dateofDelivery',TRD.cost_OF_DELIVERY_TRD as 'cost' ,ULV.NAME_ULV as 'designation'-->
<!--        FROM INVOICE_HEADER_INH INH-->
<!--        JOIN-->
<!--        (SELECT DISTINCT IDP.ID_INH_IDP,DIP.ID_DIP,DIP.ID_OWNER_USR_DIP,dip.IS_SPECIAL_DIP FROM DISPATCH_PLAN_DIP DIP JOIN INVOICE_DISPATCH_PLAN_IDP IDP-->
<!--        ON DIP.ID_DIP = IDP.ID_PLAN_IDP) INHDIP ON INH.ID_INH = INHDIP.ID_INH_IDP-->
<!--        left join TRANSPORT_DETAIL_TRD TRD ON INH.ID_INH=trd.ID_INH_TRD-->
<!--        JOIN TRANSPORTER_TRN TRN ON INH.ID_TRN_INH = TRN.ID_TRN-->
<!--        JOIN recipient_MASTER_RCT RCT ON INH.ID_RCT_INH = RCT.ID_RCT-->
<!--        join #FilterTable FT on RCT.ID_TEM_RCT = FT.ID_TEM-->
<!--        JOIN TEAM_MASTER_TEM TEM ON INH.ID_TEM_INH = TEM.ID_TEM-->
<!--        join USER_LOV_ULV ULV on INH.ID_RCT_DESG_ULV_INH =ulv.ID_ULV-->
<!--        WHERE CAST(INH.CREATED_ON_INH AS DATE) &gt;= CAST(#{StartDate} AS DATE) AND CAST(INH.CREATED_ON_INH AS DATE) &lt;= CAST(#{EndDate} AS DATE)-->
<!--        and INH.ID_STATUS_SLV_INH !='00000000-0000-0000-0000-000000000028'-->
<!--        &#45;&#45;and INHDIP.IS_SPECIAL_DIP= #{filterplan}-->
<!--        )-->

<!--        AS TempDispatchRegisterReport-->

<!--        IF(#{UserDesgID} = '2B264AFB-E2FD-483C-BD4C-C36A4E352FC5')&#45;&#45;BM-->
<!--        BEGIN-->
<!--        SELECT distinct * FROM #TempDispatchRegisterReport WHERE PlanOwnerID = #{UserID} ORDER BY InvoiceNo-->
<!--        END-->
<!--        ELSE IF(#{UserDesgID} = '88F90CCF-FB95-42DB-AECF-B4C5E8C25BE6')&#45;&#45;BEX-->
<!--        BEGIN-->
<!--        SELECT distinct businessUnit,division, InvoiceHeaderID,lrNo,courierName,noBoxes,weights,invoiceNo,values,invoiceDate,recipientID,recipient,employeeCode,-->
<!--        address, city,'state',zip,mobileNo,TeamID,teamName,nameofReceiver,dateofDelivery,cost,designation, sampleValue, itemValue-->
<!--        FROM #TempDispatchRegisterReport WHERE TeamID IN-->
<!--        (SELECT DISTINCT TET.ID_TEM_TET FROM USER_MASTER_USR USR-->
<!--        JOIN LEGAL_ENTITY_MASTER_ETY ETY ON USR.ID_ETY_USR = ETY.ID_ETY-->
<!--        JOIN TEAM_LEGAL_ENTITY_TET TET ON ETY.ID_ETY = TET.ID_ETY_TET-->
<!--         WHERE ID_USR = #{UserID})-->
<!--        ORDER BY InvoiceNo-->
<!--        END-->
<!--        ELSE&#45;&#45;HUB-->
<!--        BEGIN-->

<!--        SELECT distinct businessUnit,division,InvoiceHeaderID,lrNo,courierName,noBoxes,weights,invoiceNo,values,invoiceDate,recipientID,recipient,employeeCode,-->
<!--        address, city,state,zip,mobileNo,TeamID,teamName,nameofReceiver,dateofDelivery,cost,designation, sampleValue, itemValue-->
<!--        FROM #TempDispatchRegisterReport ORDER BY invoiceNo-->
<!--        END-->
<!--        DROP table #FilterTable-->
<!--        DROP TABLE #TempDispatchRegisterReport-->
<!--        end-->
<!--        else-->
<!--        begin-->
<!--        SELECT * INTO #FilterTable1 FROM-->
<!--        (-->
<!--        select TEM.ID_TEM,BUM.NAME_BUM as 'businessUnit', DIM.NAME_DIM as 'division' from-->
<!--        TEAM_MASTER_TEM TEM join division_MASTER_DIM DIM on TEM.ID_DIM_TEM =Dim.ID_DIM-->
<!--        join BU_MASTER_BUM BUM on DIM.ID_BUM_DIM = BUM.ID_BUM-->
<!--        where DIM.ID_BUM_DIM  in (<foreach item="item" index="index" collection="BusinessUnit"-->
<!--                                           separator=",">-->
<!--        #{item}-->
<!--    </foreach>)-->
<!--        and  DIM.ID_DIM  in (<foreach item="item" index="index" collection="Division"-->
<!--                                      separator=",">-->
<!--        #{item}-->
<!--    </foreach>)-->
<!--        TEM.ID_TEM  in (<foreach item="item" index="index" collection="Team"-->
<!--                                 separator=",">-->
<!--        #{item}-->
<!--    </foreach>)-->
<!--        ) AS FilterResult-->

<!--        SELECT * INTO #TempDispatchRegisterReport1 FROM(-->
<!--        SELECT  FT.businessUnit,FT.division, INH.ID_INH 'InvoiceHeaderID',INHDIP.ID_OWNER_USR_DIP 'PlanOwnerID',INH.LR_NUMBER_INH AS lrNo, TRN.NAME_TRN AS courierName, INH.NO_OF_BOXES_INH AS noBoxes,-->
<!--        INH.weight_INH AS 'weights',	INH.INVOICE_NO_INH AS invoiceNo,ROUND(ISNULL(INH.SAMPLE_value_INH,0) + ISNUll(INH.OTHER_ITEM_value_INH,0),2) as 'values',-->
<!--        ROUND(ISNULL(INH.SAMPLE_value_INH,0),2)  as 'sampleValue', round(ISNUll(INH.OTHER_ITEM_value_INH,0),2) as 'itemValue',-->
<!--        CONVERT(nvarchar(100),INH.CREATED_ON_INH, 103) AS invoiceDate,-->
<!--        RCT.ID_RCT 'recipientID',RCT.NAME_RCT AS recipient, RCT.CODE_RCT AS employeeCode,-->
<!--        INH.address_LINE_1_INH + ' ' + INH.address_LINE_2_INH AS 'address', INH.address_city_INH AS city, INH.address_state_INH AS 'state',-->
<!--        INH.address_zip_INH AS zip, INH.PHONE_INH AS mobileNo,TEM.ID_TEM 'TeamID',TEM.NAME_TEM AS teamName,TRD.DELIVERED_TO_NAME_TRD as 'nameofReceiver',-->
<!--        CONVERT(nvarchar(100),TRD.ACTUAL_DELIVERY_DATE_TRD, 103) as 'dateofDelivery',TRD.cost_OF_DELIVERY_TRD as 'cost' ,ULV.NAME_ULV as 'designation'-->
<!--        FROM INVOICE_HEADER_INH INH-->
<!--        JOIN-->
<!--        (SELECT DISTINCT IDP.ID_INH_IDP,DIP.ID_DIP,DIP.ID_OWNER_USR_DIP,dip.IS_SPECIAL_DIP FROM DISPATCH_PLAN_DIP DIP JOIN INVOICE_DISPATCH_PLAN_IDP IDP-->
<!--        ON DIP.ID_DIP = IDP.ID_PLAN_IDP) INHDIP ON INH.ID_INH = INHDIP.ID_INH_IDP-->
<!--        left join TRANSPORT_DETAIL_TRD TRD ON INH.ID_INH=trd.ID_INH_TRD-->
<!--        JOIN TRANSPORTER_TRN TRN ON INH.ID_TRN_INH = TRN.ID_TRN-->
<!--        JOIN recipient_MASTER_RCT RCT ON INH.ID_RCT_INH = RCT.ID_RCT-->
<!--        join #FilterTable1 FT on RCT.ID_TEM_RCT = FT.ID_TEM-->
<!--        JOIN TEAM_MASTER_TEM TEM ON INH.ID_TEM_INH = TEM.ID_TEM-->
<!--        join USER_LOV_ULV ULV on INH.ID_RCT_DESG_ULV_INH =ulv.ID_ULV-->
<!--        WHERE CAST(INH.CREATED_ON_INH AS DATE) &gt;= CAST(#{StartDate} AS DATE) AND CAST(INH.CREATED_ON_INH AS DATE) &lt;= CAST(#{EndDate} AS DATE)-->
<!--        and INH.ID_STATUS_SLV_INH !='00000000-0000-0000-0000-000000000028'-->
<!--        and INHDIP.IS_SPECIAL_DIP= #{filterplan}-->
<!--        )-->

<!--        AS TempDispatchRegisterReport1-->
<!--        IF(#{UserDesgID} = '2B264AFB-E2FD-483C-BD4C-C36A4E352FC5')&#45;&#45;BM-->
<!--        BEGIN-->
<!--        SELECT distinct * FROM #TempDispatchRegisterReport1 WHERE PlanOwnerID = #{UserID} ORDER BY InvoiceNo-->
<!--        END-->
<!--        ELSE IF(#{UserDesgID} = '88F90CCF-FB95-42DB-AECF-B4C5E8C25BE6')&#45;&#45;BEX-->
<!--        BEGIN-->
<!--        SELECT distinct businessUnit,division, InvoiceHeaderID,lrNo,courierName,noBoxes,weights,invoiceNo,values,invoiceDate,recipientID,recipient,employeeCode,-->
<!--        address, city,'state',zip,mobileNo,TeamID,teamName,nameofReceiver,dateofDelivery,cost,designation, sampleValue, itemValue-->
<!--        FROM #TempDispatchRegisterReport1 WHERE TeamID IN-->
<!--        (SELECT DISTINCT TET.ID_TEM_TET FROM USER_MASTER_USR USR-->
<!--        JOIN LEGAL_ENTITY_MASTER_ETY ETY ON USR.ID_ETY_USR = ETY.ID_ETY-->
<!--        WHERE ID_USR = #{UserID})-->
<!--        ORDER BY InvoiceNo-->
<!--        END-->
<!--        ELSE&#45;&#45;HUB-->
<!--        BEGIN-->

<!--        SELECT distinct businessUnit,division,InvoiceHeaderID,lrNo,courierName,noBoxes,weights,invoiceNo,values,invoiceDate,recipientID,recipient,employeeCode,-->
<!--        address, city,state,zip,mobileNo,TeamID,teamName,nameofReceiver,dateofDelivery,cost,designation, sampleValue, itemValue-->
<!--        FROM #TempDispatchRegisterReport1 ORDER BY invoiceNo-->
<!--        END-->

<!--        DROP TABLE #FilterTable1-->
<!--        DROP TABLE #TempDispatchRegisterReport1-->
<!--        end-->


<!--    </select>-->


    <select id="getReportDispatchRegister" resultType="com.squer.promobee.controller.dto.DispatchRegisterReportDTO">
        IF (#{filterplan}=2)
        begin
        SELECT * INTO #FilterTable FROM
        (
        select TEM.ID_TEM,BUM.NAME_BUM as 'BusinessUnit', DIM.NAME_DIM as 'Division' from
        TEAM_MASTER_TEM TEM join DIVISION_MASTER_DIM DIM on TEM.ID_DIM_TEM =Dim.ID_DIM
        join BU_MASTER_BUM BUM on DIM.ID_BUM_DIM = BUM.ID_BUM
        where DIM.ID_BUM_DIM  in (<foreach item="item" index="index" collection="BusinessUnit"
                                           separator=",">
        #{item}
    </foreach>)
        and DIM.ID_DIM  in (<foreach item="item" index="index" collection="Division"
                                     separator=",">
        #{item}
    </foreach>)
        and TEM.ID_TEM  in (<foreach item="item" index="index" collection="Team"
                                     separator=",">
        #{item}
    </foreach>)
        ) AS FilterResult

        SELECT * INTO #TempDispatchRegisterReport FROM(
        SELECT  FT.BusinessUnit,FT.Division, INH.ID_INH 'InvoiceHeaderID',INHDIP.ID_OWNER_USR_DIP 'PlanOwnerID',INH.LR_NUMBER_INH AS LRNo, TRN.NAME_TRN AS CourierName, INH.NO_OF_BOXES_INH AS NoOfBoxes,
        INH.WEIGHT_INH AS 'Weight',	INH.INVOICE_NO_INH AS InvoiceNo,ROUND(ISNULL(INH.SAMPLE_VALUE_INH,0) + ISNUll(INH.OTHER_ITEM_VALUE_INH,0),2) as 'Value',
        ROUND(ISNULL(INH.SAMPLE_VALUE_INH,0),2)  as 'SampleValue', round(ISNUll(INH.OTHER_ITEM_VALUE_INH,0),2) as 'ItemValue',
        CONVERT(nvarchar(100),INH.CREATED_ON_INH, 103) AS InvoiceDate,
        RCT.ID_RCT 'RecipientID',RCT.NAME_RCT AS Recipient, RCT.CODE_RCT AS EmployeeCode,
        INH.ADDRESS_LINE_1_INH + ' ' + INH.ADDRESS_LINE_2_INH AS 'Address', INH.ADDRESS_CITY_INH AS City, INH.ADDRESS_STATE_INH AS 'State',
        INH.ADDRESS_ZIP_INH AS Zip, INH.PHONE_INH AS MobileNo,TEM.ID_TEM 'TeamID',TEM.NAME_TEM AS TeamName,TRD.DELIVERED_TO_NAME_TRD as 'NameofReceiver',
        CONVERT(nvarchar(100),TRD.ACTUAL_DELIVERY_DATE_TRD, 103) as 'DateofDelivery',TRD.COST_OF_DELIVERY_TRD as 'Cost' ,ULV.NAME_ULV as 'Designation'
        FROM INVOICE_HEADER_INH INH
        JOIN
        (SELECT DISTINCT IDP.ID_INH_IDP,DIP.ID_DIP,DIP.ID_OWNER_USR_DIP,dip.IS_SPECIAL_DIP FROM DISPATCH_PLAN_DIP DIP JOIN INVOICE_DISPATCH_PLAN_IDP IDP
        ON DIP.ID_DIP = IDP.ID_PLAN_IDP) INHDIP ON INH.ID_INH = INHDIP.ID_INH_IDP
        left join TRANSPORT_DETAIL_TRD TRD ON INH.ID_INH=trd.ID_INH_TRD
        JOIN TRANSPORTER_TRN TRN ON INH.ID_TRN_INH = TRN.ID_TRN
        JOIN RECIPIENT_MASTER_RCT RCT ON INH.ID_RCT_INH = RCT.ID_RCT
        join #FilterTable FT on RCT.ID_TEM_RCT = FT.ID_TEM
        JOIN TEAM_MASTER_TEM TEM ON INH.ID_TEM_INH = TEM.ID_TEM
        join USER_LOV_ULV ULV on INH.ID_RCT_DESG_ULV_INH =ulv.ID_ULV
        WHERE CAST(INH.CREATED_ON_INH AS DATE) &gt;= CAST(#{StartDate} AS DATE) AND CAST(INH.CREATED_ON_INH AS DATE) &lt;= CAST(#{EndDate} AS DATE)
        and INH.ID_STATUS_SLV_INH !='00000000-0000-0000-0000-000000000028'

        )

        AS TempDispatchRegisterReport

        IF(#{UserDesgID} = '2B264AFB-E2FD-483C-BD4C-C36A4E352FC5')--BM
        BEGIN
        SELECT distinct * FROM #TempDispatchRegisterReport WHERE PlanOwnerID = #{UserID} ORDER BY InvoiceNo
        END
        ELSE IF(#{UserDesgID} = '88F90CCF-FB95-42DB-AECF-B4C5E8C25BE6')--BEX
        BEGIN
        SELECT distinct BusinessUnit,Division, InvoiceHeaderID,LRNo,CourierName,NoOfBoxes,[Weight],InvoiceNo,Value,InvoiceDate,RecipientID,Recipient,EmployeeCode,
        Address, City,'State',Zip,MobileNo,TeamID,TeamName,NameofReceiver,DateofDelivery,Cost,Designation, SampleValue, ItemValue
        FROM #TempDispatchRegisterReport WHERE TeamID IN
        (SELECT DISTINCT TET.ID_TEM_TET FROM USER_MASTER_USR USR
        JOIN LEGAL_ENTITY_MASTER_ETY ETY ON USR.ID_ETY_USR = ETY.ID_ETY
        JOIN TEAM_LEGAL_ENTITY_TET TET ON ETY.ID_ETY = TET.ID_ETY_TET
        WHERE ID_USR = #{UserID})
        ORDER BY InvoiceNo
        END
        ELSE--HUB
        BEGIN

        SELECT distinct BusinessUnit,Division,InvoiceHeaderID,LRNo,CourierName,NoOfBoxes,[Weight],InvoiceNo,Value,InvoiceDate,RecipientID,Recipient,EmployeeCode,
        Address, City,State,Zip,MobileNo,TeamID,TeamName,NameofReceiver,DateofDelivery,Cost,Designation, SampleValue, ItemValue
        FROM #TempDispatchRegisterReport ORDER BY InvoiceNo
        END
        DROP table #FilterTable
        DROP TABLE #TempDispatchRegisterReport
        end
        else
        begin
        SELECT * INTO #FilterTable1 FROM
        (
        select TEM.ID_TEM,BUM.NAME_BUM as 'BusinessUnit', DIM.NAME_DIM as 'Division' from
        TEAM_MASTER_TEM TEM join DIVISION_MASTER_DIM DIM on TEM.ID_DIM_TEM =Dim.ID_DIM
        join BU_MASTER_BUM BUM on DIM.ID_BUM_DIM = BUM.ID_BUM
        where DIM.ID_BUM_DIM  in (<foreach item="item" index="index" collection="BusinessUnit"
                                           separator=",">
        #{item}
    </foreach>)
        and  DIM.ID_DIM  in (<foreach item="item" index="index" collection="Division"
                                      separator=",">
        #{item}
    </foreach>)
        and  TEM.ID_TEM  in (<foreach item="item" index="index" collection="Team"
                                      separator=",">
        #{item}
    </foreach>)
        ) AS FilterResult

        SELECT * INTO #TempDispatchRegisterReport1 FROM(
        SELECT  FT.BusinessUnit,FT.Division, INH.ID_INH 'InvoiceHeaderID',INHDIP.ID_OWNER_USR_DIP 'PlanOwnerID',INH.LR_NUMBER_INH AS LRNo, TRN.NAME_TRN AS CourierName, INH.NO_OF_BOXES_INH AS NoOfBoxes,
        INH.WEIGHT_INH AS 'Weight',	INH.INVOICE_NO_INH AS InvoiceNo,ROUND(ISNULL(INH.SAMPLE_VALUE_INH,0) + ISNUll(INH.OTHER_ITEM_VALUE_INH,0),2) as 'Value',
        ROUND(ISNULL(INH.SAMPLE_VALUE_INH,0),2)  as 'SampleValue', round(ISNUll(INH.OTHER_ITEM_VALUE_INH,0),2) as 'ItemValue',
        CONVERT(nvarchar(100),INH.CREATED_ON_INH, 103) AS InvoiceDate,
        RCT.ID_RCT 'RecipientID',RCT.NAME_RCT AS Recipient, RCT.CODE_RCT AS EmployeeCode,
        INH.ADDRESS_LINE_1_INH + ' ' + INH.ADDRESS_LINE_2_INH AS 'Address', INH.ADDRESS_CITY_INH AS City, INH.ADDRESS_STATE_INH AS 'State',
        INH.ADDRESS_ZIP_INH AS Zip, INH.PHONE_INH AS MobileNo,TEM.ID_TEM 'TeamID',TEM.NAME_TEM AS TeamName,TRD.DELIVERED_TO_NAME_TRD as 'NameofReceiver',
        CONVERT(nvarchar(100),TRD.ACTUAL_DELIVERY_DATE_TRD, 103) as 'DateofDelivery',TRD.COST_OF_DELIVERY_TRD as 'Cost' ,ULV.NAME_ULV as 'Designation'
        FROM INVOICE_HEADER_INH INH
        JOIN
        (SELECT DISTINCT IDP.ID_INH_IDP,DIP.ID_DIP,DIP.ID_OWNER_USR_DIP,dip.IS_SPECIAL_DIP FROM DISPATCH_PLAN_DIP DIP JOIN INVOICE_DISPATCH_PLAN_IDP IDP
        ON DIP.ID_DIP = IDP.ID_PLAN_IDP) INHDIP ON INH.ID_INH = INHDIP.ID_INH_IDP
        left join TRANSPORT_DETAIL_TRD TRD ON INH.ID_INH=trd.ID_INH_TRD
        JOIN TRANSPORTER_TRN TRN ON INH.ID_TRN_INH = TRN.ID_TRN
        JOIN RECIPIENT_MASTER_RCT RCT ON INH.ID_RCT_INH = RCT.ID_RCT
        join #FilterTable1 FT on RCT.ID_TEM_RCT = FT.ID_TEM
        JOIN TEAM_MASTER_TEM TEM ON INH.ID_TEM_INH = TEM.ID_TEM
        join USER_LOV_ULV ULV on INH.ID_RCT_DESG_ULV_INH =ulv.ID_ULV
        WHERE CAST(INH.CREATED_ON_INH AS DATE) &gt;= CAST(#{StartDate} AS DATE) AND CAST(INH.CREATED_ON_INH AS DATE) &lt;= CAST(#{EndDate} AS DATE)
        and INH.ID_STATUS_SLV_INH !='00000000-0000-0000-0000-000000000028'
        and INHDIP.IS_SPECIAL_DIP= #{filterplan}
        )

        AS TempDispatchRegisterReport1
        IF(#{UserDesgID} = '2B264AFB-E2FD-483C-BD4C-C36A4E352FC5')--BM
        BEGIN
        SELECT distinct * FROM #TempDispatchRegisterReport1 WHERE PlanOwnerID = #{UserID} ORDER BY InvoiceNo
        END
        ELSE IF(#{UserDesgID} = '88F90CCF-FB95-42DB-AECF-B4C5E8C25BE6')--BEX
        BEGIN
        SELECT distinct BusinessUnit,Division, InvoiceHeaderID,LRNo,CourierName,NoOfBoxes,[Weight],InvoiceNo,Value,InvoiceDate,RecipientID,Recipient,EmployeeCode,
        Address, City,'State',Zip,MobileNo,TeamID,TeamName,NameofReceiver,DateofDelivery,Cost,Designation, SampleValue, ItemValue
        FROM #TempDispatchRegisterReport1 WHERE TeamID IN
        (SELECT DISTINCT TET.ID_TEM_TET FROM USER_MASTER_USR USR
        JOIN LEGAL_ENTITY_MASTER_ETY ETY ON USR.ID_ETY_USR = ETY.ID_ETY
        JOIN TEAM_LEGAL_ENTITY_TET TET ON ETY.ID_ETY = TET.ID_ETY_TET
        WHERE ID_USR = #{UserID})
        ORDER BY InvoiceNo
        END
        ELSE--HUB
        BEGIN

        SELECT distinct BusinessUnit,Division,InvoiceHeaderID,LRNo,CourierName,NoOfBoxes,[Weight],InvoiceNo,Value,InvoiceDate,RecipientID,Recipient,EmployeeCode,
        Address, City,State,Zip,MobileNo,TeamID,TeamName,NameofReceiver,DateofDelivery,Cost,Designation, SampleValue, ItemValue
        FROM #TempDispatchRegisterReport1 ORDER BY InvoiceNo
        END

        DROP TABLE #FilterTable1
        DROP TABLE #TempDispatchRegisterReport1
        end
    </select>


    <select id="getReportDeviation" resultType="com.squer.promobee.controller.dto.DeviationReportDTO" parameterType = "map" statementType = "CALLABLE">
        { call PROC_ReportDeviation(#{QuarterName, jdbcType = VARCHAR, mode = IN},#{FromDate, jdbcType = VARCHAR, mode = IN}, #{ToDate, jdbcType = VARCHAR, mode = IN},
        #{UserID, jdbcType = VARCHAR, mode = IN},
        #{UserDesgID, jdbcType = VARCHAR, mode = IN}) }
    </select>


    <select id="getReportItemConsumption" resultType="com.squer.promobee.controller.dto.ItemConsumptionReportDTO" parameterType = "map" statementType = "CALLABLE">
        { call PROC_ReportItemConsumption (#{FromDate, jdbcType = VARCHAR, mode = IN}, #{ToDate, jdbcType = VARCHAR, mode = IN},
        #{UserID, jdbcType = VARCHAR, mode = IN},#{UserDesgID, jdbcType = VARCHAR, mode = IN},#{BusinessUnit, jdbcType = VARCHAR, mode = IN},
        #{Division, jdbcType = VARCHAR, mode = IN}) }

    </select>


    <select id="getReportDestruction" resultType="com.squer.promobee.controller.dto.DestructionReportDTO" parameterType = "map" statementType = "CALLABLE">
        { call PROC_ReportDestruction (#{FromDate, jdbcType = VARCHAR, mode = IN}, #{ToDate, jdbcType = VARCHAR, mode = IN},
        #{UserID, jdbcType = VARCHAR, mode = IN},#{UserDesgID, jdbcType = VARCHAR, mode = IN},#{BusinessUnit, jdbcType = VARCHAR, mode = IN},
        #{Division, jdbcType = VARCHAR, mode = IN},#{StatusID, jdbcType = VARCHAR, mode = IN}) }

    </select>


<!--    <select id="getReportSimpleInventory" resultType="com.squer.promobee.controller.dto.SimpleInventoryReportDTO" parameterType = "map" statementType = "CALLABLE">-->

<!--        <foreach collection="BusinessUnit" item="buItem" open="(" separator="," close=")">-->
<!--        <foreach collection="Division" item="divItem" open="(" separator="," close=")">-->




<!--        </foreach>-->
<!--        </foreach>-->

<!--        {call PROC_ReportSimpleInventory   ( #{buItem},#{divItem},#{UserID, jdbcType = VARCHAR, mode = IN },#{UserDesgID,jdbcType = VARCHAR, mode = IN })}-->


<!--    </select>-->

<!--    <select id="getReportSimpleInventory" resultType="com.squer.promobee.controller.dto.SimpleInventoryReportDTO" parameterType="map" statementType="CALLABLE">-->
<!--        { call PROC_ReportSimpleInventory (-->
<!--        <foreach collection="BusinessUnit" item="buId" separator="," open="(" close=")" index="index">-->
<!--            <if test="buId != null and buId != ''">-->
<!--                #{buId}-->
<!--            </if>-->
<!--        </foreach>,-->
<!--        <foreach collection="Division" item="divId" separator="," open="(" close=")" index="index">-->
<!--            <if test="divId != null and divId != ''">-->
<!--                #{divId}-->
<!--            </if>-->
<!--        </foreach>,-->
<!--        #{UserID, jdbcType=VARCHAR, mode=IN},-->
<!--        #{UserDesgID, jdbcType=VARCHAR, mode=IN}-->
<!--        )}-->
<!--    </select>-->

<!--    <select id="getReportSimpleInventory" resultType="com.squer.promobee.controller.dto.NearToExpiryReportDTO" parameterType = "map" statementType = "CALLABLE">-->
<!--        { call PROC_ReportSimpleInventory (   #{BusinessUnit, jdbcType = VARCHAR, mode = IN},-->
<!--                                           #{Division, jdbcType = VARCHAR, mode = IN},#{UserID, jdbcType = VARCHAR, mode = IN},#{UserDesgID, jdbcType = VARCHAR, mode = IN}-->
<!--         ) }-->

<!--    </select>-->


    <select id="getReportSimpleInventory"  resultType="com.squer.promobee.controller.dto.SimpleInventoryReportDTO">
        SELECT * INTO #FilterTable FROM
        (
        select BRD.ID_BRD,BUM.NAME_BUM as 'businessUnit', DIM.NAME_DIM as 'division' from
        BRAND_MASTER_BRD BRD
        join DIVISION_BRAND_DBR DBR on BRD.ID_BRD= dbr.ID_BRD_DBR
        join DIVISION_MASTER_DIM DIM on dbr.ID_DIM_DBR =Dim.ID_DIM
        join BU_MASTER_BUM BUM on DIM.ID_BUM_DIM = BUM.ID_BUM
        where DIM.ID_BUM_DIM  in (<foreach item="item" index="index" collection="BusinessUnit"
                                           separator=",">
        #{item}
    </foreach>)
        and  DIM.ID_DIM  in (<foreach item="item" index="index" collection="Division"
                                      separator=",">
        #{item}
    </foreach>)

        ) AS FilterResult



        SELECT * INTO #TEMPTABLE FROM (

        SELECT distinct FT.businessUnit,FT.division, INV.ID_INV,CCM.ID_CCM AS 'costCenterId', CCM.NAME_CCM AS 'costCenter',ITC.NAME_ITC AS 'category', ITM.CODE_ITM AS 'productCode', ITM.NAME_ITM AS 'productName',
        CONVERT(nvarchar(100), INV.POSTING_DATE_INV, 103) AS 'grnDate',INV.MEDICAL_CODE_INV 'medicalCode',Round(INV.RATE_PER_UNIT_INV,2) 'rate',INV.PO_NO_INV AS 'poNo',INV.BATCH_NO_INV AS 'batchNo',
        CONVERT(nvarchar(100), INV.EXPIRY_DATE_INV, 103) AS 'expiryDate',INV.PACK_SIZE_INV AS 'basePack',INV.QTY_RECEIVED_INV AS 'receivedQuantity', INV.QTY_ALLOCATED_INV AS 'allocatedQuantity',
        INV.QTY_DISPATCHED_INV AS 'dispatchedQuantity',(INV.QTY_RECEIVED_INV - (INV.QTY_ALLOCATED_INV + INV.QTY_DISPATCHED_INV)) AS 'allocationBalance',
        (INV.QTY_RECEIVED_INV - INV.QTY_DISPATCHED_INV) 'physicalBalance',inv.HSN_CODE_INV as 'hsn_Code',inv.RATE_PER_INV as 'gst_Rate'
        FROM INVENTORY_INV INV
        JOIN ITEM_MASTER_ITM ITM ON INV.ID_ITM_INV = ITM.ID_ITM
        JOIN ITEM_CATEGORY_MASTER_ITC ITC ON ITM.ID_ITC_ITM = ITC.ID_ITC
        JOIN COST_CENTER_MASTER_CCM CCM ON ITM.ID_CCM_ITM = CCM.ID_CCM
        join COSTCENTER_BRAND_CBR CBR on CCM.ID_CCM=CBR.ID_CCM_CBR
        JOIN BRAND_MASTER_BRD BRD ON CBR.ID_BRD_CBR = BRD.ID_BRD
        JOIN #FilterTable FT on BRD.ID_BRD  = FT.ID_BRD

        UNION

        SELECT distinct FT.businessUnit,FT.division,INV.ID_INV, FT.ID_BRD AS 'costCenterId', BRD.NAME_BRD AS 'costCenter','Sample' AS 'category', SMP.LMID_SMP AS 'productCode', SMP.NAME_SMP AS 'productName',
        CONVERT(nvarchar(100), INV.POSTING_DATE_INV, 103) AS 'grnDate',INV.MEDICAL_CODE_INV 'medicalCode',Round(INV.RATE_PER_UNIT_INV,2) 'rate',INV.PO_NO_INV AS 'poNo',INV.BATCH_NO_INV AS 'batchNo',
        CONVERT(nvarchar(100), INV.EXPIRY_DATE_INV, 103) AS 'expiryDate',INV.PACK_SIZE_INV AS 'basePack',INV.QTY_RECEIVED_INV AS 'receivedQuantity', INV.QTY_ALLOCATED_INV AS 'allocatedQuantity',
        INV.QTY_DISPATCHED_INV AS 'dispatchedQuantity',(INV.QTY_RECEIVED_INV - (INV.QTY_ALLOCATED_INV + INV.QTY_DISPATCHED_INV)) AS 'allocationBalance',
        (INV.QTY_RECEIVED_INV - INV.QTY_DISPATCHED_INV) 'physicalBalance',inv.HSN_CODE_INV as 'hsn_Code',inv.RATE_PER_INV as 'gst_Rate'
        FROM INVENTORY_INV INV
        JOIN SAMPLE_MASTER_SMP SMP ON INV.ID_ITM_INV = SMP.ID_SMP
        JOIN BRAND_MASTER_BRD BRD ON SMP.ID_BRD_SMP = BRD.ID_BRD
        JOIN  #FilterTable FT  ON BRD.ID_BRD = FT.ID_BRD
        ) AS FirstResultSet


        IF(#{UserDesgID} = '2B264AFB-E2FD-483C-BD4C-C36A4E352FC5')--BM

        BEGIN

        SELECT distinct * FROM #TEMPTABLE WHERE CostCenterID IN (SELECT DISTINCT ID_CCM_CBR FROM BRANDMANAGER_BRAND_BBR BBR
        JOIN COSTCENTER_BRAND_CBR CBR ON BBR.ID_BRD_BBR = CBR.ID_BRD_CBR WHERE BBR.ID_USR_BBR = #{UserID}
        UNION SELECT ID_BRD_BBR FROM BRANDMANAGER_BRAND_BBR WHERE ID_USR_BBR = #{UserID})
        AND PhysicalBalance > 0



        END

        ELSE IF(#{UserDesgID} = '88F90CCF-FB95-42DB-AECF-B4C5E8C25BE6')--BEX

        BEGIN

        SELECT distinct * FROM #TEMPTABLE WHERE CostCenterID IN (
        SELECT DISTINCT CBR.ID_CCM_CBR FROM COSTCENTER_BRAND_CBR CBR
        JOIN TEAM_BRAND_TBR TBR ON CBR.ID_BRD_CBR = TBR.ID_BRD_TBR
        JOIN TEAM_LEGAL_ENTITY_TET TET ON TBR.ID_TEM_TBR = TET.ID_TEM_TET
        join USER_LEGAL_ENTITY_ULE ULE on TET.ID_ETY_TET = ULE.ID_ETY_ULE
        join USER_MASTER_USR USR on USR.ID_USR= ULE.ID_USR_ULE
        WHERE USR.ID_USR = #{UserID}


        UNION

        SELECT DISTINCT TBR.ID_BRD_TBR FROM TEAM_BRAND_TBR TBR
        JOIN TEAM_LEGAL_ENTITY_TET TET ON TBR.ID_TEM_TBR = TET.ID_TEM_TET
        join USER_LEGAL_ENTITY_ULE ULE on TET.ID_ETY_TET = ULE.ID_ETY_ULE
        join USER_MASTER_USR USR on USR.ID_USR= ULE.ID_USR_ULE
        WHERE USR.ID_USR = #{UserID}
        )
        AND PhysicalBalance > 0



        END

        ELSE--HUB

        BEGIN

        SELECT distinct * From #TEMPTABLE WHERE PhysicalBalance > 0

        END


        DROP TABLE #FilterTable

        DROP TABLE #TEMPTABLE
    </select>

<!--    <select id="getReportSimpleInventory"  resultType="com.squer.promobee.controller.dto.SimpleInventoryReportDTO" parameterType = "map" statementType = "CALLABLE">-->

<!--        { call PROC_ReportSimpleInventory ( <foreach item="item" index="index" collection="BusinessUnit"-->
<!--                                                     open="(" separator="," close=")" >-->
<!--        #{item}-->
<!--    </foreach>,-->
<!--        <foreach item="item" index="index" collection="Division"-->
<!--                 open="(" separator="," close=")" >#{item}-->
<!--          </foreach>-->
<!--        ,-->
<!--        #{UserID, jdbcType = VARCHAR, mode = IN},-->
<!--        #{UserDesgID, jdbcType = VARCHAR, mode = IN}-->
<!--        )  }-->

<!--    </select>-->








    <select id="getReportNearToExpirySample" resultType="com.squer.promobee.controller.dto.NearToExpiryReportDTO" parameterType = "map" statementType = "CALLABLE">
        { call PROC_ReportNearToExpiry (   #{BusinessUnit, jdbcType = VARCHAR, mode = IN},
        #{Division, jdbcType = VARCHAR, mode = IN},#{UserID, jdbcType = VARCHAR, mode = IN},#{UserDesgID, jdbcType = VARCHAR, mode = IN}
        ,#{Type, jdbcType = VARCHAR, mode = IN}) }

    </select>

    <select id="getReportNearToExpiryInput" resultType="com.squer.promobee.controller.dto.NearToExpiryReportDTO" parameterType = "map" statementType = "CALLABLE">
        { call PROC_ReportNearToExpiry (#{BusinessUnit, jdbcType = VARCHAR, mode = IN},
        #{Division, jdbcType = VARCHAR, mode = IN},#{UserID, jdbcType = VARCHAR, mode = IN},#{UserDesgID, jdbcType = VARCHAR, mode = IN}
        ,#{Type, jdbcType = VARCHAR, mode = IN}) }

    </select>


    <select id="getReportSpecialDispatch" resultType="com.squer.promobee.controller.dto.SpecialDispatchReportDTO" parameterType = "map" statementType = "CALLABLE">
        { call PROC_ReportSpecialDispatch (#{FromDate, jdbcType = VARCHAR, mode = IN}, #{ToDate, jdbcType = VARCHAR, mode = IN},
        #{UserID, jdbcType = VARCHAR, mode = IN},#{UserDesgID, jdbcType = VARCHAR, mode = IN},#{BusinessUnit, jdbcType = VARCHAR, mode = IN},
        #{Division, jdbcType = VARCHAR, mode = IN}) }

    </select>


    <select id="getReportDispatchByTeam" resultType="com.squer.promobee.controller.dto.DispatchByTeamReportDTO" parameterType = "map" statementType = "CALLABLE">
        { call PROC_GET_DISPATCH_PLAN_FOR_YEAR (#{YEAR, jdbcType = VARCHAR, mode = IN}, #{Special, jdbcType = VARCHAR, mode = IN}) }

    </select>

    <select id="getItemWiseReport" resultType="com.squer.promobee.controller.dto.ItemWiseReportDTO" parameterType = "map" statementType = "CALLABLE">
        { call PROC_ReportGetAggregateInventory (#{FromDate, jdbcType = VARCHAR, mode = IN}, #{ToDate, jdbcType = VARCHAR, mode = IN},
                                           #{BusinessUnit, jdbcType = VARCHAR, mode = IN},
                                           #{Division, jdbcType = VARCHAR, mode = IN}) }

    </select>

    <select id="getStockLedgerReport" resultType="com.squer.promobee.controller.dto.StockLedgerReportDTO" parameterType = "map" statementType = "CALLABLE">
        { call PROC_ReportGetStockLedger (#{FromDate, jdbcType = VARCHAR, mode = IN}, #{ToDate, jdbcType = VARCHAR, mode = IN},
                                                #{ItemID, jdbcType = VARCHAR, mode = IN}) }

    </select>

    <select id="getAgeingReport" resultType="com.squer.promobee.controller.dto.AgeingReportDTO" parameterType = "map" statementType = "CALLABLE">
        { call PROC_ReportAgeing (#{UserID, jdbcType = VARCHAR, mode = IN}, #{UserDesgID, jdbcType = VARCHAR, mode = IN},
                                          #{BusinessUnit, jdbcType = VARCHAR, mode = IN}, #{Division, jdbcType = VARCHAR, mode = IN}) }

    </select>

    <select id="getShiprocketReport" resultType="com.squer.promobee.controller.dto.ShiprocketReportDTO" parameterType = "map" statementType = "CALLABLE">
        { call get_shiprocketdata (#{fromdate, jdbcType = VARCHAR, mode = IN}, #{enddate, jdbcType = VARCHAR, mode = IN}) }

    </select>

    <select id="getVirtualReconciliationReport" resultType="com.squer.promobee.controller.dto.VirtualReconciliationDTO" parameterType = "map" statementType = "CALLABLE">
        { call GetVirtualReconciliationReport (#{fromdate, jdbcType = VARCHAR, mode = IN}, #{enddate, jdbcType = VARCHAR, mode = IN}, #{BusinessUnit, jdbcType = VARCHAR, mode = IN}) }

    </select>






</mapper>
