<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="UploadLogMapper">
    <resultMap id="uploadLogResultMap" type="com.squer.promobee.service.repository.domain.UploadLog">
        <id property="id" column="id_upl"/>
        <result property="startTime" column="start_time_upl"/>
        <result property="endTime" column="end_time_upl"/>
        <result property="totalRecord" column="total_records_upl"/>
        <result property="recordUpload" column="records_upload_upl"/>
        <result property="parentId" column="parent_id_upl"/>
        <result property="createdAt" column="created_on_upl"/>
        <result property="createdBy" column="created_by_upl"/>
        <result property="updatedAt" column="updated_on_upl"/>
        <result property="updatedBy" column="updated_by_upl"/>
        <association property="type" javaType="com.squer.promobee.security.domain.NamedSquerEntity">
            <id property="id" column="idtypeslv_upl"/>
            <result property="name" column="name_slv"/>
        </association>
        <association property="statusId" javaType="com.squer.promobee.security.domain.NamedSquerEntity">
            <id property="id" column="id_status_slv_upl"/>
            <result property="name" column="name_slv"/>
        </association>
    </resultMap>
    
    <select id="uploadLogSelectByStatusId" resultMap="uploadLogResultMap">
        select ID_UPL ,IDTYPESLV_UPL ,START_TIME_UPL ,END_TIME_UPL ,TOTAL_RECORDS_UPL ,RECORDS_UPLOAD_UPL ,ID_STATUS_SLV_UPL
                ,CREATED_ON_UPL ,CREATED_BY_UPL ,UPDATED_ON_UPL ,UPDATED_BY_UPL ,PARENT_ID_UPL from UPLOAD_LOG_UPL where IDTYPESLV_UPL = #{statusId}
    </select>

    <select id="getGrnUploadLog" resultType="com.squer.promobee.controller.dto.UploadLogDTO">
        SELECT TOP 25 UPL.START_TIME_UPL as 'startTime',UPL.END_TIME_UPL as 'endTime',UPL.TOTAL_RECORDS_UPL as 'totalRecord',UPL.RECORDS_UPLOAD_UPL as 'recordUpload',
        SLV.NAME_SLV as 'status' FROM UPLOAD_LOG_UPL UPL
        JOIN SYSTEM_LOV_SLV SLV ON SLV.ID_SLV = UPL.ID_STATUS_SLV_UPL
        WHERE UPL.IDTYPESLV_UPL = '00000000-0000-0000-0000-100000000020'
    </select>

    <select id="getTransporterUploadLog" resultType="com.squer.promobee.controller.dto.UploadLogDTO">
        SELECT TOP 25 UPL.START_TIME_UPL as 'startTime',UPL.END_TIME_UPL as 'endTime',UPL.TOTAL_RECORDS_UPL as 'totalRecord',UPL.RECORDS_UPLOAD_UPL as 'recordUpload',
                SLV.NAME_SLV as 'status' FROM UPLOAD_LOG_UPL UPL
        JOIN SYSTEM_LOV_SLV SLV ON SLV.ID_SLV = UPL.ID_STATUS_SLV_UPL

    </select>

    <select id="getInvoiceUploadLog" resultType="com.squer.promobee.controller.dto.UploadLogDTO">
        SELECT TOP 25 UPL.START_TIME_UPL as 'startTime',UPL.END_TIME_UPL as 'endTime',UPL.TOTAL_RECORDS_UPL as 'totalRecord',UPL.RECORDS_UPLOAD_UPL as 'recordUpload',
                SLV.NAME_SLV as 'status' FROM UPLOAD_LOG_UPL UPL
        JOIN SYSTEM_LOV_SLV SLV ON SLV.ID_SLV = UPL.ID_STATUS_SLV_UPL

    </select>

    <insert id="insertUploadLogQueued">
        INSERT INTO UPLOAD_LOG_UPL (ID_UPL,IDTYPESLV_UPL,START_TIME_UPL,END_TIME_UPL,TOTAL_RECORDS_UPL,RECORDS_UPLOAD_UPL,ID_STATUS_SLV_UPL,CREATED_ON_UPL,CREATED_BY_UPL,UPDATED_ON_UPL,UPDATED_BY_UPL,PARENT_ID_UPL)
        VALUES(#{id},#{type},GETDATE(),GETDATE(),NULL,#{recordUpload},#{statusId},GETDATE(),#{createdBy},GETDATE(),#{updatedBy},#{parentId})
    </insert>

    <insert id="insertUploadLogFileNotFound">
        INSERT INTO UPLOAD_LOG_UPL (ID_UPL,IDTYPESLV_UPL,START_TIME_UPL,END_TIME_UPL,TOTAL_RECORDS_UPL,RECORDS_UPLOAD_UPL,ID_STATUS_SLV_UPL,CREATED_ON_UPL,CREATED_BY_UPL,UPDATED_ON_UPL,UPDATED_BY_UPL,PARENT_ID_UPL)
        VALUES(#{id},#{type},GETDATE(),GETDATE(),#{totalRecord},#{recordUpload},#{statusId},GETDATE(),#{createdBy},GETDATE(),#{updatedBy},#{parentId})
    </insert>

    <update  id="uploadTransportDetails" parameterType = "map" statementType = "CALLABLE">
        { call PROC_UPLOAD_TRANSPORTER (#{uploadId, jdbcType = VARCHAR, mode = IN}, #{createdBy, jdbcType = VARCHAR, mode = IN}) }

    </update>

    <insert id="insertTempTransportDetails">
        INSERT INTO TEMP_TRANSPORT_DETAIL_TRT (ID_TRT,ID_UPLOAD_UPL_TRT,INVOICE_NO,ID_INH_TRT,LR_NO_TRT,DISPATCH_DATE_TRT,EXPECTED_DELIVERY_DATE_TRT,ACTUAL_DELIVERY_DATE_TRT,ID_TRN_TRT,NAME_TRN_TRT,
                                               DELIVERED_TO_NAME_TRT,COST_OF_DELIVERY_TRT,ID_DOCET_ULV_TRT,STATE_DOCET_TRT,ERROR_TEXT,BOX_NO_TRT,WEIGHT_TRT)
        VALUES(#{transportId},#{transportUploadId},#{invoiceNo},NULL,#{lrNo},#{dispatchDate},#{expectedDeliveryDate},#{actuallyDeliveryDate},NULL,#{trnName},
               #{deliveredToName},#{deliveryCost},NULL,#{docketState},NULL,#{boxNo},#{weight})
    </insert>


    <select id="transportExcelData" resultType="com.squer.promobee.controller.dto.TransporterUploadDto">
        select INVOICE_NO as 'invoiceNo',LR_NO_TRT as 'lrNo',BOX_NO_TRT as 'boxNo',WEIGHT_TRT as 'weight', DISPATCH_DATE_TRT as 'dispatchDate',
                EXPECTED_DELIVERY_DATE_TRT as 'expectedDeliveryDate',ACTUAL_DELIVERY_DATE_TRT as 'actuallyDeliveryDate',NAME_TRN_TRT as 'trnName',
                DELIVERED_TO_NAME_TRT as 'deliveredToName',COST_OF_DELIVERY_TRT as 'deliveryCost',STATE_DOCET_TRT as 'docketState',ERROR_TEXT as 'errorText'
        from TEMP_TRANSPORT_DETAIL_TRT where ID_UPLOAD_UPL_TRT = #{id}

    </select>

    <insert id="insertTempGrnDetails">
        INSERT INTO TEMP_GRN_UPLOAD_GRT (ID_GRT,ID_UPLOAD_UPL_GRT,PO_NO_GRT,COST_CENTER_GRT,ID_CCM_GRT,MATERIAL_GRT,BATCH_NO_GRT,MATERIAL_DESCRIPTION_GRT,
                                         POSTING_DATE_GRT,QTY_IN_GRN,AMOUNT_GRT,
                                         VENDOR_CODE_GRT,VENDOR_NAME_GRT,ID_VND_GRT,RATE_PER_UNIT_GRT,MEDICAL_CODE_GRT,MAT_DOC_GRT,
                                         ITEM_NAME_GRT,SAMPLE_EXPIRY_GRT,ERROR_TEXT,EXPIRY_DATE_GRT,HSN_CODE_GRT)
        VALUES(#{grnId},#{grnUploadId},#{poNo},#{costCenter},NULL,#{material},#{batchNo},#{materialDescription},#{postingDate},#{quantity},#{amount},
               #{vendorCode},#{vendorName},NULL,#{ratePerUnit},#{medicalCode},
               NULL,#{itemNo},#{sampleExpiry},NULL,#{expiryDate},NULL)
    </insert>


    <update  id="uploadGrnDetails" parameterType = "map" statementType = "CALLABLE">
        { call PROC_VALIDATE_GRN_UPLOAD (#{uploadid, jdbcType = VARCHAR, mode = IN}, #{createdBy, jdbcType = VARCHAR, mode = IN}) }

    </update>


    <select id="grnExcelData" resultType="com.squer.promobee.controller.dto.GrnUploadDTO">
        select PO_NO_GRT as 'poNo',COST_CENTER_GRT as 'costCenter', MATERIAL_GRT as 'material',BATCH_NO_GRT as 'batchNo', MATERIAL_DESCRIPTION_GRT as 'materialDescription',
                POSTING_DATE_GRT as 'postingDate', QTY_IN_GRN as 'quantity',AMOUNT_GRT as 'amount',VENDOR_CODE_GRT as 'vendorCode',VENDOR_NAME_GRT as 'vendorName',RATE_PER_UNIT_GRT as 'ratePerUnit',
                MEDICAL_CODE_GRT as 'medicalCode', MAT_DOC_GRT as 'materialDoc',ITEM_NAME_GRT as 'itemNo',SAMPLE_EXPIRY_GRT as 'sampleExpiry',ERROR_TEXT as 'errorText',EXPIRY_DATE_GRT as 'expiryDate'
        from TEMP_GRN_UPLOAD_GRT where ID_UPLOAD_UPL_GRT =  #{id}

    </select>


    <insert id="insertTempRecipientDetails">
        INSERT INTO TEMP_RECIPIENT_RTT (ID_RTT,ID_UPLOAD_UPL_RTT,NAME_RTT,CODE_RTT,ADDRESS_RTT,CITY_RTT,STATE_RTT,ZIP_RTT,
                                        EMAIL_RTT,MOBILE_RTT,DESIGNATION_RTT,HQ_RTT,ZONE_RTT,JOINING_DATE_RTT,TEAM_RTT,STATUS_RTT,ERROR_TEXT_RTT,REMARKS_RTT,
                                        WORKID_RTT,GENDER_RTT,EMAIL_RM_RTT,EMAIL_AM_RTT,BUM_RTT)
        VALUES(#{recipientId},#{recipientUploadId},#{name},#{code},#{address},#{city},#{state},#{zip},#{email},#{mobile},#{designation},
               #{headquarter},#{zone},#{joiningDate},#{team},#{status},
               NULL,#{remarks},#{workId},#{gender},#{emailRM},#{emailAM},#{bu})
    </insert>


    <update  id="uploadRecipientDetails" parameterType = "map" statementType = "CALLABLE">
        { call PROC_RECIPIENT_UPLOAD (#{uploadid, jdbcType = VARCHAR, mode = IN}, #{createdBy, jdbcType = VARCHAR, mode = IN}) }

    </update>

    <select id="recipientExcelData" resultType="com.squer.promobee.controller.dto.RecipientUploadDTO">
        select NAME_RTT as 'name',CODE_RTT as 'code',ADDRESS_RTT as 'address', CITY_RTT as 'city', STATE_RTT as 'state',ZIP_RTT as 'zip',EMAIL_RTT as 'email',
                MOBILE_RTT as 'mobile',DESIGNATION_RTT as 'designation',HQ_RTT as 'headquarter',ZONE_RTT as 'zone', JOINING_DATE_RTT as 'joiningDate',TEAM_RTT as 'team',
                STATUS_RTT as 'status',REMARKS_RTT as 'remarks',WORKID_RTT as 'workId',GENDER_RTT as 'gender',EMAIL_RM_RTT as 'emailRM', EMAIL_AM_RTT as 'emailAM',BUM_RTT as 'bu'
        from TEMP_RECIPIENT_RTT where ID_UPLOAD_UPL_RTT = #{id}


    </select>



    <insert id="insertTempVirtualSampleDetails">

        INSERT INTO TEMP_VIRTUALUPLOAD_VLS (ID_VLS,UPLOAD_ID_VLS,CREATEDBY_VLS,USER_EMAIL_VLS,EMP_ID_VLS,SKU_VLS,LOT_VLS,EXTERNAL_VLS,CUSTOMER_VLS,MOBILE_VLS,
                                            QUANTITY_VLS,REQUEST_STATUS_VLS,TEAM_VLS,SUB_TEAM_VLS,
                                            ADDRESS_VLS,STREET1_VLS,STREET2_VLS,STREET3_VLS,CITY_VLS,STATE_VLS,POSTAL_CODE_VLS,
                                            DATE_CREATED_VLS,REQUEST_COMPLETED_VLS,REQUEST_STARTED_VLS,ERROR_TEXT,IS_HCP,ID_TEM_VLS,TERRITORY_VLS)
        VALUES(#{virtualId},#{virtualUploadId},#{createdBy},#{userEmail},#{empId},#{sku},#{lot},#{externalId},#{customer},#{mobile},#{quantity},
               #{requestStatus},#{team},#{subTeam},#{address},#{street1},#{street2},#{street3},#{city},#{state},#{postalCode},
               #{dateCreated},#{requestCompleted},#{requestStarted},#{errorText},NULL,NULL,#{territory})
    </insert>


    <update  id="uploadVirtualSampleDetails" parameterType = "map" statementType = "CALLABLE">
        { call PROC_VIRTUAL_UPLOAD (#{uploadid, jdbcType = VARCHAR, mode = IN}, #{createdBy, jdbcType = VARCHAR, mode = IN})
            , #{frommonth, jdbcType = INTEGER, mode = IN}) , #{tomonth, jdbcType = INTEGER, mode = IN})}

    </update>



    <select id="virtualSampleExcelData" resultType="com.squer.promobee.controller.dto.VirtualSampleUploadDTO">
        select CREATEDBY_VLS as 'createdBy', USER_EMAIL_VLS as 'userEmail', EMP_ID_VLS as 'empId', SKU_VLS as 'sku', LOT_VLS as 'lot', EXTERNAL_VLS as 'externalId', CUSTOMER_VLS as 'customer', MOBILE_VLS as 'mobile',
                QUANTITY_VLS as 'quantity' , REQUEST_STATUS_VLS as 'requestStatus', TEAM_VLS as 'team', SUB_TEAM_VLS as 'subTeam', ADDRESS_VLS as 'address', STREET1_VLS as 'street1', STREET2_VLS as 'street2', STREET3_VLS as 'street3',
                CITY_VLS as 'city', STATE_VLS as 'state', POSTAL_CODE_VLS as 'postalCode', DATE_CREATED_VLS as 'dateCreated', REQUEST_COMPLETED_VLS as 'requestCompleted', REQUEST_STARTED_VLS as 'requestStarted',
                ERROR_TEXT as 'errorText' from TEMP_VIRTUALUPLOAD_VLS
        where UPLOAD_ID_VLS = #{id}


    </select>

</mapper>